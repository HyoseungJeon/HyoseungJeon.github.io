<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Thread Local | HyoSeung IT blog</title><meta name=keywords content="Java,Thread"><meta name=description content="📌 개선하고 싶은 사항이 생겼다!! 현재 프로젝트에서는 등록자, 수정자 Id 값을 모든 Entity 담아 보내는 방식으로 N개의 List 데이터를 보낼 시 모든 객체에 중복되는 id 값을 모두 담고.. 또 넣어주는 소스도 존재하고 있다..!! 사실 이렇게 관리할 필요가 전혀 없어 보여서.. 개선을 해보기로 하였다!! 하여 작업 중 ThreadLocal Class를 보게 되었다!! Java에서 굉장히 초기버전 부터 지원해왔던 기능이라던데 굉장히 유용하고 또 실제로 많은 Lib에서 활용하고 있다는 걸 알게되었다!! 한번 자세히 알아보자~~😁😁 Thread Local 정의 This class provides thread-local variables."><meta name=author content="HyoSeung Jeon"><link rel=canonical href=https://HyoseungJeon.github.io/posts/java/threadlocal/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://HyoseungJeon.github.io/profile.png><link rel=icon type=image/png sizes=16x16 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><script defer crossorigin=anonymous src=/js/pro.sidebar.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Thread Local"><meta property="og:description" content="📌 개선하고 싶은 사항이 생겼다!! 현재 프로젝트에서는 등록자, 수정자 Id 값을 모든 Entity 담아 보내는 방식으로 N개의 List 데이터를 보낼 시 모든 객체에 중복되는 id 값을 모두 담고.. 또 넣어주는 소스도 존재하고 있다..!! 사실 이렇게 관리할 필요가 전혀 없어 보여서.. 개선을 해보기로 하였다!! 하여 작업 중 ThreadLocal Class를 보게 되었다!! Java에서 굉장히 초기버전 부터 지원해왔던 기능이라던데 굉장히 유용하고 또 실제로 많은 Lib에서 활용하고 있다는 걸 알게되었다!! 한번 자세히 알아보자~~😁😁 Thread Local 정의 This class provides thread-local variables."><meta property="og:type" content="article"><meta property="og:url" content="https://HyoseungJeon.github.io/posts/java/threadlocal/"><meta property="og:image" content="https://HyoseungJeon.github.io/profile2.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-26T16:55:04+09:00"><meta property="article:modified_time" content="2024-04-26T16:55:04+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://HyoseungJeon.github.io/profile2.png"><meta name=twitter:title content="Thread Local"><meta name=twitter:description content="📌 개선하고 싶은 사항이 생겼다!! 현재 프로젝트에서는 등록자, 수정자 Id 값을 모든 Entity 담아 보내는 방식으로 N개의 List 데이터를 보낼 시 모든 객체에 중복되는 id 값을 모두 담고.. 또 넣어주는 소스도 존재하고 있다..!! 사실 이렇게 관리할 필요가 전혀 없어 보여서.. 개선을 해보기로 하였다!! 하여 작업 중 ThreadLocal Class를 보게 되었다!! Java에서 굉장히 초기버전 부터 지원해왔던 기능이라던데 굉장히 유용하고 또 실제로 많은 Lib에서 활용하고 있다는 걸 알게되었다!! 한번 자세히 알아보자~~😁😁 Thread Local 정의 This class provides thread-local variables."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://HyoseungJeon.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Java","item":"https://HyoseungJeon.github.io/posts/java/"},{"@type":"ListItem","position":3,"name":"Thread Local","item":"https://HyoseungJeon.github.io/posts/java/threadlocal/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Thread Local","name":"Thread Local","description":"📌 개선하고 싶은 사항이 생겼다!! 현재 프로젝트에서는 등록자, 수정자 Id 값을 모든 Entity 담아 보내는 방식으로 N개의 List 데이터를 보낼 시 모든 객체에 중복되는 id 값을 모두 담고.. 또 넣어주는 소스도 존재하고 있다..!! 사실 이렇게 관리할 필요가 전혀 없어 보여서.. 개선을 해보기로 하였다!! 하여 작업 중 ThreadLocal Class를 보게 되었다!! Java에서 굉장히 초기버전 부터 지원해왔던 기능이라던데 굉장히 유용하고 또 실제로 많은 Lib에서 활용하고 있다는 걸 알게되었다!! 한번 자세히 알아보자~~😁😁 Thread Local 정의 This class provides thread-local variables.","keywords":["Java","Thread"],"articleBody":" 📌 개선하고 싶은 사항이 생겼다!! 현재 프로젝트에서는 등록자, 수정자 Id 값을 모든 Entity 담아 보내는 방식으로 N개의 List 데이터를 보낼 시 모든 객체에 중복되는 id 값을 모두 담고.. 또 넣어주는 소스도 존재하고 있다..!! 사실 이렇게 관리할 필요가 전혀 없어 보여서.. 개선을 해보기로 하였다!! 하여 작업 중 ThreadLocal Class를 보게 되었다!! Java에서 굉장히 초기버전 부터 지원해왔던 기능이라던데 굉장히 유용하고 또 실제로 많은 Lib에서 활용하고 있다는 걸 알게되었다!! 한번 자세히 알아보자~~😁😁 Thread Local 정의 This class provides thread-local variables. These variables differ from their normal counterparts in that each thread that accesses one (via its get or set method) has its own, independently initialized copy of the variable. ThreadLocal instances are typically private static fields in classes that wish to associate state with a thread (e.g., a user ID or Transaction ID). 출처\n간단히 말하면 단일 Thread 내에서 사용 가능한 변수를 제공하는 Class 이다. 해당 Class 정의 시 각 thread가 복사본을 소지하게 되어 각자 독립적인 형태로 사용 가능하게 된다.\n함수 요약 T get() - Thread 지역변수 값 return\nprotected T initialValue() - Thread 지역변수 초기값 return\nvoid remove() - Thread 지역변수 값 삭제\nvoid set(T value) - Thread 지역변수 값 설정\nstatic ThreadLocal withInitial (Supplier\u003c? extends S\u003e supplier)\nThread 지역변수 Supplier 형태로 설정\n주의점 Spring Server는 Tomcat을 통하여 동작하여 ThreadPool 방식을 사용한다! 하여 thread가 재활용 되어 사용되는데 문제점은 이 부분에서 발생한다!\n만약 Thread 지역변수 값을 사용 종료시에 remove() 해주지 않으면 데이터가 엉켜 잘못된 값을 참조하거나 혹은 데이터가 변조될 가능성이 생긴다! 하여 필히 사용이 끝나면 해당 값을 삭제해주는 부분이 필요하다!\n현재 프로젝트에서는 Controller 동작 마지막 부분에서 삭제하는 방식을 채택하고 있다!\n사용예제 프로젝트 내에서는 MSA 환경에서 Rest Client를 활용하여 통신을 한다. 기존 버전에서는 기본적으로 request Header에 locale, Language, Timezone 등의 정보만을 담아 사용하고 있었다! 헌데 Client의 Id값은 담고 있지 않아 body나 query param에 매번 id 값을 담는 작업을 하여 사용하고 있었다..\n해서 AA 분에게 해당 사항에 대해 말씀드렸고, header에 Client의 ID 값을 추가하는 것이 문제가 없다고 판단되어 해당 작업을 진행하였다!\n후에 static Method로 해당 Client 정보를 조회하는 method를 통해 ThreadLocal에 담겨있는 id 값을 가져와 사용할 수 있게 되었다!\n하여 따로 등록, 수정자 값을 추가해주는 코드를 삭제한 후, Mybatis Mapper 내에서 bind 기능을 활용해 위의 method를 통하여 Client 정보를 조회한 후 활용하는 방식으로 수정하였다!\n결과적으로 송신 단에서는 id 값을 따로 담거나, 신경 쓸 필요 없이 작업을 하게 되었고, 쓸데없는 담는 과정도 삭제할 수 있었다. 또한 아마 부하가 크진 않지만 전송하는 body의 데이터 양도 줄일 수 있었다! (1,000개 이상의 데이터도 송신하는 경우가 잦았다) 하여 크진 않지만 유의미한 네트워킹 속도 향상도 기대할 수 있었다!\n간단한 소스 ","wordCount":"600","inLanguage":"en","datePublished":"2024-04-26T16:55:04+09:00","dateModified":"2024-04-26T16:55:04+09:00","author":{"@type":"Person","name":"HyoSeung Jeon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://HyoseungJeon.github.io/posts/java/threadlocal/"},"publisher":{"@type":"Organization","name":"HyoSeung IT blog","logo":{"@type":"ImageObject","url":"https://HyoseungJeon.github.io/profile.png"}}}</script><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/main.css></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://HyoseungJeon.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://HyoseungJeon.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://HyoseungJeon.github.io/posts/ title=posts class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>posts</span></a></li><li><a href=https://HyoseungJeon.github.io/tags/ title=tags class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>tags</span></a></li><li><a href=https://HyoseungJeon.github.io/archives/ title=archives class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>archives</span></a></li><li><a href=https://HyoseungJeon.github.io/search/ title="search (Alt + /)" class=btn-12 accesskey=/><span style=font-family:SUITE-Regular;font-size:19px>search</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://HyoseungJeon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/java/>Java</a></div><h1 class=post-title>Thread Local</h1><div class=post-meta><span title='2024-04-26 16:55:04 +0900 +0900'>April 26, 2024</span>&nbsp;·&nbsp;600 words&nbsp;·&nbsp;HyoSeung Jeon</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner style=padding-top:10px><ul><li><a href=#thread-local aria-label="Thread Local">Thread Local</a><ul><li><a href=#%ec%a0%95%ec%9d%98 aria-label=정의>정의</a></li><li><a href=#%ed%95%a8%ec%88%98-%ec%9a%94%ec%95%bd aria-label="함수 요약">함수 요약</a></li><li><a href=#%ec%a3%bc%ec%9d%98%ec%a0%90 aria-label=주의점>주의점</a></li></ul></li><li><a href=#%ec%82%ac%ec%9a%a9%ec%98%88%ec%a0%9c aria-label=사용예제>사용예제</a><ul><li><a href=#%ea%b0%84%eb%8b%a8%ed%95%9c-%ec%86%8c%ec%8a%a4 aria-label="간단한 소스">간단한 소스</a></li></ul></li><li><a href=#%eb%8a%90%eb%82%80%ec%a0%90 aria-label=느낀점>느낀점</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?(document.getElementById("toc-container").classList.add("wide"),document.getElementById("menu-container").style.display=""):(document.getElementById("toc-container").classList.remove("wide"),document.getElementById("menu-container").style.display="none")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css><link rel=stylesheet href=https://unpkg.com/css-pro-layout@1.1.0/dist/css/css-pro-layout.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"><script src=https://unpkg.com/@popperjs/core@2></script><div id=menu-container class="layout toc-container wide-r"><aside id=sidebar class="sidebar break-point-sm has-bg-image" style=width:100%;position:sticky;top:var(--gap)><div class=sidebar-layout><div class=sidebar-content><nav class="menu open-current-submenu"><ul><li class="menu-item sub-menu" name=API data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>API
<span class=menu-title-suffix>(4)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=FCM data-level=1><a href=/posts/api/fcm/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>FCM</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Nice 본인인증" data-level=1><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice 본인인증</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Nice본인인증 이슈대응" data-level=1><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%91/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증 이슈대응</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Nice본인인증이슈대응2 data-level=1><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증이슈대응2</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Chrome data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Chrome
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=Debug data-level=1><a href=/posts/chrome/debug/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Debug</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name="Design Pattern" data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Design Pattern
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item sub-menu" name="Behavioral Patterns" data-level=1><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Behavioral Patterns
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Strategy Pattern" data-level=2><a href=/posts/designpattern/behavioralpatterns/strategypattern/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Strategy Pattern</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item page-menu" name="Creational Patterns" data-level=1><a href=/posts/designpattern/creationalpatterns/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Creational Patterns</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Structural Patterns" data-level=1><a href=/posts/designpattern/structuralpatterns/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Structural Patterns</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=ETC data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>ETC
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="MSA Id Auditing" data-level=1><a href=/posts/etc/msaidauditing/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>MSA Id Auditing</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="MSA 환경 TraceId Logging" data-level=1><a href=/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>MSA 환경 TraceId Logging</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=OAuth data-level=1><a href=/posts/etc/oauth/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>OAuth</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=HTML data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>HTML
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Page Reload Issue" data-level=1><a href=/posts/html/pagereloadissue/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Page Reload Issue</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Page Reload Issue 2" data-level=1><a href=/posts/html/pagereloadissue2/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Page Reload Issue 2</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Intellij data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Intellij
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Properties Auto Upper" data-level=1><a href=/posts/intellij/propertiesautoupper/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Properties Auto Upper</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Thymeleaf data-level=1><a href=/posts/intellij/thymeleaf/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Thymeleaf</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Java data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java
<span class=menu-title-suffix>(9)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Blocking Queue" data-level=1><a href=/posts/java/blockingqueue/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Blocking Queue</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Cursor data-level=1><a href=/posts/java/cursor/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Cursor</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=File data-level=1><a href=/posts/java/file/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>File</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Function Package" data-level=1><a href=/posts/java/function-package/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Function Package</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Future data-level=1><a href=/posts/java/future/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Future</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Generic data-level=1><a href=/posts/java/generic/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Generic</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Reflection data-level=1><a href=/posts/java/reflection/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Reflection</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Synchronized data-level=1><a href=/posts/java/synchronized/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Synchronized</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Thread Local" data-level=1><a href=/posts/java/threadlocal/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Thread Local</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name="Java Script" data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java Script
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Custom Validate" data-level=1><a href=/posts/javascript/customvalidate/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Custom Validate</span>
<span class=menu-suffix></span></a></li><li class="menu-item sub-menu" name=Date data-level=1><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Date
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=setDate data-level=2><a href=/posts/javascript/date/setdate/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>setDate</span>
<span class=menu-suffix></span></a></li></ul></div></li></ul></div></li><li class="menu-item sub-menu" name=JQuery data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>JQuery
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="JQuery Validate" data-level=1><a href=/posts/jquery/validate/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>JQuery Validate</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=ZTree data-level=1><a href=/posts/jquery/ztree/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>ZTree</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Spring data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Spring
<span class=menu-title-suffix>(6)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=Async data-level=1><a href=/posts/spring/async/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Async</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Cache data-level=1><a href=/posts/spring/cache/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Cache</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Custom Validate Annotation" data-level=1><a href=/posts/spring/customvalidateannotation/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Custom Validate Annotation</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=RequestContextHolder data-level=1><a href=/posts/spring/requestcontextholder/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>RequestContextHolder</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Scope data-level=1><a href=/posts/spring/scope/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Scope</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Spring Security" data-level=1><a href=/posts/spring/springsecurity/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Spring Security</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=SQL data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>SQL
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="With Recursive" data-level=1><a href=/posts/sql/withrecursive/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>With Recursive</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Window data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Window
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Nud 메모리누수" data-level=1><a href=/posts/window/nud%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%88%84%EC%88%98/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nud 메모리누수</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=독후감 data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>독후감
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Clean Architecture" data-level=1><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/cleanarchitecture/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Clean Architecture</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="쏙쏙 들어오는 함수형 코딩" data-level=1><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/%ED%95%A8%EC%88%98%ED%98%95%EC%BD%94%EB%94%A9/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>쏙쏙 들어오는 함수형 코딩</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=일기장 data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>일기장
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=23.07.18 data-level=1><a href=/posts/%EC%9D%BC%EA%B8%B0%EC%9E%A5/23-07-18/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>23.07.18</span>
<span class=menu-suffix></span></a></li></ul></div></li><ul></nav></div></div><div class=sidebar-footer></div></aside></div><style scoped></style><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/pro-sidebar.css><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition()},!1),window.addEventListener("resize",function(){checkTocPosition()},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("menu-container").style.display="":document.getElementById("menu-container").style.display="none"}</script><div class=post-content><hr><style>#callout{background:#f1f1ef;padding:1.5em 1.25em;border-radius:3px;display:flex;flex-direction:row;margin-bottom:20px;color:var(--hljs-bg)}#callout-inner{margin-left:1em;white-space:pre-line}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>📌</div><div id=callout-inner>개선하고 싶은 사항이 생겼다!! 현재 프로젝트에서는 등록자, 수정자 Id 값을 모든 Entity 담아 보내는 방식으로 N개의 List 데이터를 보낼 시 모든 객체에 중복되는 id 값을 모두 담고.. 또 넣어주는 소스도 존재하고 있다..!!
사실 이렇게 관리할 필요가 전혀 없어 보여서.. 개선을 해보기로 하였다!!
하여 작업 중 ThreadLocal Class를 보게 되었다!! Java에서 굉장히 초기버전 부터 지원해왔던 기능이라던데 굉장히 유용하고 또 실제로 많은 Lib에서 활용하고 있다는 걸 알게되었다!! 한번 자세히 알아보자~~😁😁</div></div><h2 id=thread-local>Thread Local<a hidden class=anchor aria-hidden=true href=#thread-local>#</a></h2><h3 id=정의>정의<a hidden class=anchor aria-hidden=true href=#정의>#</a></h3><blockquote><p>This class provides thread-local variables. These variables differ from their normal counterparts in that each thread that accesses one (via its <code>get</code> or <code>set</code> method) has its own, independently initialized copy of the variable. <code>ThreadLocal</code> instances are typically private static fields in classes that wish to associate state with a thread (e.g., a user ID or Transaction ID).
<a href=https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadLocal.html>출처</a></p></blockquote><p>간단히 말하면 단일 Thread 내에서 사용 가능한 변수를 제공하는 Class 이다.
해당 Class 정의 시 각 thread가 복사본을 소지하게 되어 각자 독립적인 형태로 사용 가능하게 된다.</p><h3 id=함수-요약>함수 요약<a hidden class=anchor aria-hidden=true href=#함수-요약>#</a></h3><ul><li><p><code>T get()</code> - Thread 지역변수 값 return</p></li><li><p><code>protected T initialValue()</code> - Thread 지역변수 초기값 return</p></li><li><p><code>void remove()</code> - Thread 지역변수 값 삭제</p></li><li><p><code>void set(T value)</code> - Thread 지역변수 값 설정</p></li><li><p><code>static &lt;S> ThreadLocal&lt;S> withInitial (Supplier&lt;? extends S> supplier)</code></p><p>Thread 지역변수 Supplier 형태로 설정</p></li></ul><h3 id=주의점>주의점<a hidden class=anchor aria-hidden=true href=#주의점>#</a></h3><p>Spring Server는 Tomcat을 통하여 동작하여 ThreadPool 방식을 사용한다! 하여 thread가 재활용 되어 사용되는데 문제점은 이 부분에서 발생한다!</p><p>만약 Thread 지역변수 값을 사용 종료시에 remove() 해주지 않으면 데이터가 엉켜 잘못된 값을 참조하거나 혹은 데이터가 변조될 가능성이 생긴다! 하여 필히 사용이 끝나면 해당 값을 삭제해주는 부분이 필요하다!</p><p>현재 프로젝트에서는 Controller 동작 마지막 부분에서 삭제하는 방식을 채택하고 있다!</p><h2 id=사용예제>사용예제<a hidden class=anchor aria-hidden=true href=#사용예제>#</a></h2><p>프로젝트 내에서는 MSA 환경에서 Rest Client를 활용하여 통신을 한다.
기존 버전에서는 기본적으로 request Header에 locale, Language, Timezone 등의 정보만을 담아 사용하고 있었다! 헌데 Client의 Id값은 담고 있지 않아 body나 query param에 매번 id 값을 담는 작업을 하여 사용하고 있었다..</p><p>해서 AA 분에게 해당 사항에 대해 말씀드렸고, header에 Client의 ID 값을 추가하는 것이 문제가 없다고 판단되어 해당 작업을 진행하였다!</p><p>후에 static Method로 해당 Client 정보를 조회하는 method를 통해 ThreadLocal에 담겨있는 id 값을 가져와 사용할 수 있게 되었다!</p><p>하여 따로 등록, 수정자 값을 추가해주는 코드를 삭제한 후, Mybatis Mapper 내에서 <code>bind</code> 기능을 활용해 위의 method를 통하여 Client 정보를 조회한 후 활용하는 방식으로 수정하였다!</p><p>결과적으로 송신 단에서는 id 값을 따로 담거나, 신경 쓸 필요 없이 작업을 하게 되었고, 쓸데없는 담는 과정도 삭제할 수 있었다. 또한 아마 부하가 크진 않지만 전송하는 body의 데이터 양도 줄일 수 있었다! (1,000개 이상의 데이터도 송신하는 경우가 잦았다) 하여 크진 않지만 유의미한 네트워킹 속도 향상도 기대할 수 있었다!</p><h3 id=간단한-소스>간단한 소스<a hidden class=anchor aria-hidden=true href=#간단한-소스>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;bind</span> <span class=na>name=</span><span class=s>&#34;clientInfo&#34;</span> <span class=na>value=</span><span class=s>&#39;@com.package.common.rest.ClientInfoHolder@getClientInfo()&#39;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>~~~~
</span></span><span class=line><span class=cl>#{clientInfo.userId}
</span></span><span class=line><span class=cl>~~~~
</span></span></code></pre></div><h2 id=느낀점>느낀점<a hidden class=anchor aria-hidden=true href=#느낀점>#</a></h2><p>JPA를 공부할 때 Entity Class에 간단하게 Annotation으로 생성, 수정자 Id 값을 처리할 수 있었다! 하여 개발자는 해당 id 값에 관하여 전혀 신경쓰지 않고 작업을 할 수 있었다. 물론 이 정도는 아니지만 적어도 MSA 환경 내에서 id 값의 set 여부에 관해서는 작업자가 Query 단까지 작업을 하기 전까지는 신경을 쓸 필요가 없어졌다! 이는 나로서는 굉장한 작업의 편의성을 가져왔다!! 또한 기본 BaseEntity에서 defalut 생성자로 TimeZone, Locale 값을 설정하여 다국어 조회를 위한 Query에 활용하기 위해 가져와 사용하고 있었다.. 사실 해당 값은 N개 만큼 존재할 필요도 없는데 매우 많은 값들이 N개 만큼 정의되어 왔다갔다 하는 상황이였다! 이 또한 예제의 bind 내의 Client 값을 활용하여 대체할 수 있었다!! 하여 작업 생산성이 굉장히 향상되었다.. ☺☺</p><p>알다시피 Spring boot Server에서 request 처리는 단일 thread내에서 처리된다!! ThreadLocal도 단일 thread에서 활용할 수 있는 변수값을 설정 가능하게 되어 하나의 요청에 따른 지역변수 값을 설정하고 사용하기에 매우 편리한 기능이였다!!! 사실 Spring Security, RequestContextHolder 등에서도 이미 위 Class를 사용해 구현되어 있다고 하더라.. 사실 Thread로 동작하는 Java에서는 어떻게 보면 당연히 존재하는 Class 일 수도 있는데 이제야 안것도 조금 머쓱한 것 같다 ㅎ..😂 늦게라도 이렇게 알게되어서 얼마나 좋은가!?!? 해피해피🤗</p><p>출처</p><p><a href=https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadLocal.html>ThreadLocal (Java Platform SE 8 )</a>
<a href=https://catsbi.oopy.io/3ddf4078-55f0-4fde-9d51-907613a44c0d>https://catsbi.oopy.io/3ddf4078-55f0-4fde-9d51-907613a44c0d</a>
<a href=https://dev.gmarket.com/62>https://dev.gmarket.com/62</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://HyoseungJeon.github.io/tags/java/>Java</a></li><li><a href=https://HyoseungJeon.github.io/tags/thread/>Thread</a></li></ul><nav class=paginav><a class=next href=https://HyoseungJeon.github.io/posts/spring/customvalidateannotation/><span class=title>Next »</span><br><span>Custom Validate Annotation</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://HyoseungJeon.github.io/>HyoSeung IT blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>