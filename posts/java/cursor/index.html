<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cursor | HyoSeung IT blog</title><meta name=keywords content="Java,Mybatis,Persistence Framework"><meta name=description content="💡 Batch 개발을 하는 도중 다른 job 소스를 참고하는데 엄청나게 많은 데이터를 읽어오는 reader 단을 짠 소스를 보았다..!! 이거 이렇게 읽어와도.. 문제가 없나?? 라는 생각이 들었고 내부 소스를 확인해보니.. Cursor 란 친구로 데이터를 읽어오고 있었다! 이전에 본 적이 없는 Class 였다!! 이 친구가 문제를 해결해 주고 있는 것 같아 내용이 궁금해져서 찾아보게 되었다!! Cursor란? 정의 Cursor contract to handle fetching items lazily using an Iterator. Cursors are a perfect fit to handle millions of items queries that would not normally fit in memory."><meta name=author content="HyoSeung Jeon"><link rel=canonical href=https://HyoseungJeon.github.io/posts/java/cursor/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://HyoseungJeon.github.io/profile.png><link rel=icon type=image/png sizes=16x16 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><script defer crossorigin=anonymous src=/js/pro.sidebar.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Cursor"><meta property="og:description" content="💡 Batch 개발을 하는 도중 다른 job 소스를 참고하는데 엄청나게 많은 데이터를 읽어오는 reader 단을 짠 소스를 보았다..!! 이거 이렇게 읽어와도.. 문제가 없나?? 라는 생각이 들었고 내부 소스를 확인해보니.. Cursor 란 친구로 데이터를 읽어오고 있었다! 이전에 본 적이 없는 Class 였다!! 이 친구가 문제를 해결해 주고 있는 것 같아 내용이 궁금해져서 찾아보게 되었다!! Cursor란? 정의 Cursor contract to handle fetching items lazily using an Iterator. Cursors are a perfect fit to handle millions of items queries that would not normally fit in memory."><meta property="og:type" content="article"><meta property="og:url" content="https://HyoseungJeon.github.io/posts/java/cursor/"><meta property="og:image" content="https://HyoseungJeon.github.io/profile2.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-23T08:58:04+09:00"><meta property="article:modified_time" content="2023-11-23T08:58:04+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://HyoseungJeon.github.io/profile2.png"><meta name=twitter:title content="Cursor"><meta name=twitter:description content="💡 Batch 개발을 하는 도중 다른 job 소스를 참고하는데 엄청나게 많은 데이터를 읽어오는 reader 단을 짠 소스를 보았다..!! 이거 이렇게 읽어와도.. 문제가 없나?? 라는 생각이 들었고 내부 소스를 확인해보니.. Cursor 란 친구로 데이터를 읽어오고 있었다! 이전에 본 적이 없는 Class 였다!! 이 친구가 문제를 해결해 주고 있는 것 같아 내용이 궁금해져서 찾아보게 되었다!! Cursor란? 정의 Cursor contract to handle fetching items lazily using an Iterator. Cursors are a perfect fit to handle millions of items queries that would not normally fit in memory."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://HyoseungJeon.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Java","item":"https://HyoseungJeon.github.io/posts/java/"},{"@type":"ListItem","position":3,"name":"Cursor","item":"https://HyoseungJeon.github.io/posts/java/cursor/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cursor","name":"Cursor","description":"💡 Batch 개발을 하는 도중 다른 job 소스를 참고하는데 엄청나게 많은 데이터를 읽어오는 reader 단을 짠 소스를 보았다..!! 이거 이렇게 읽어와도.. 문제가 없나?? 라는 생각이 들었고 내부 소스를 확인해보니.. Cursor 란 친구로 데이터를 읽어오고 있었다! 이전에 본 적이 없는 Class 였다!! 이 친구가 문제를 해결해 주고 있는 것 같아 내용이 궁금해져서 찾아보게 되었다!! Cursor란? 정의 Cursor contract to handle fetching items lazily using an Iterator. Cursors are a perfect fit to handle millions of items queries that would not normally fit in memory.","keywords":["Java","Mybatis","Persistence Framework"],"articleBody":" 💡 Batch 개발을 하는 도중 다른 job 소스를 참고하는데 엄청나게 많은 데이터를 읽어오는 reader 단을 짠 소스를 보았다..!! 이거 이렇게 읽어와도.. 문제가 없나?? 라는 생각이 들었고 내부 소스를 확인해보니.. Cursor 란 친구로 데이터를 읽어오고 있었다! 이전에 본 적이 없는 Class 였다!! 이 친구가 문제를 해결해 주고 있는 것 같아 내용이 궁금해져서 찾아보게 되었다!! Cursor란? 정의 Cursor contract to handle fetching items lazily using an Iterator. Cursors are a perfect fit to handle millions of items queries that would not normally fit in memory. If you use collections in resultMaps then cursor SQL queries must be ordered (resultOrdered=“true”) using the id columns of the resultMap. 출처 - https://mybatis.org/mybatis-3/apidocs/org/apache/ibatis/cursor/Cursor.html\n짧게 요약하면 Lazy loading 이라고 할 수 있을 것 같다.\nIterator를 사용하여 데이터를 천천히 적재하여 처리할 수 있도록 돕는 interface 이다.\n사용법 @Service @Transactional int processDummyDataList() { try { mapper.getDummyDataList().forEach(el -\u003e { // 처리 }) } catch (Exception e) { // ~~~ } } @Mapper Cursor\u003cString\u003e getDummyDataList(); 사용법은 굉장히 간단하다! List Class로 조회하던 부분을 Cursor로 바꾸어서 사용하면 끝이다..! 하면 DB의 option에 따라 (fetchSize) data를 가져오고 처리하는 방식으로 동작한다!\n❗ 단, Cursor는 데이터를 지속적으로 읽어오기 위해 DB Conntetion이 유지되어야 한다! 하여 @Transaction 어노테이션을 선언해 주어야 한다! 중요 포인트 결국 이 서버의 fetchSize를 각 환경을 고려해서 적절하게 선언하는 것이 중요하다고 보인다!! 사용하는 서버의 메모리 용량, 평소 사용량, 필요한 속도, 네트워크의 사양 등등 다양한 요소를 고려하여 값을 설정할 필요성이 있다!\nfetchSize가 크다면, 메모리의 적재량이 커지고, 처리 시간이 빨라질 것 이다. fetchSize가 작다면, 메모리의 적재량은 줄지만, 처리 시간은 늘어날 것 이다.\n내 생각 확실히 Batch Server와 성격이 잘 맞는 것 같다! 빠른 응답보단 에러 없이 안전하게 데이터를 처리해 주는 것이 더 중요한 서버에 필요한 기능 같다!! 특히나 대용량의 데이터를 처리해야 하기 때문에 OOM을 염려할 수 밖에 없을텐데 이에서 완벽하게 벗어날 수 있다는 것이 매우 큰 안정성을 가져 오는 것 같다!\n이러한 Class가.. mybatis에서 꽤나 오랫동안 존재했던 소스라는게 조금 신기했다..! 항상 Spring을 통하여 쉽게 사용했던 Mybatis 였는데.. 이러한 Persistence Framework에 집중해본 것은 처음이였다! JPA를 통해서 공부를 할 때에는 해당 동작 원리 등에 대하여 학습하였는데 정작 실 업무에서 사용하는 mybatis에 대해서는 조금 무지했지 않았나.. 라는 생각을 들게 했다 😅😅 이번 기회로 또 넓은 방향의 생각을 갖게 됐으니 그만이지 싶다..! 🙄\n출처 Cursor (mybatis 3.5.15 API) Cursor MyBatis의 fetchSize와 Cursor 이야기\n","wordCount":"361","inLanguage":"en","datePublished":"2023-11-23T08:58:04+09:00","dateModified":"2023-11-23T08:58:04+09:00","author":{"@type":"Person","name":"HyoSeung Jeon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://HyoseungJeon.github.io/posts/java/cursor/"},"publisher":{"@type":"Organization","name":"HyoSeung IT blog","logo":{"@type":"ImageObject","url":"https://HyoseungJeon.github.io/profile.png"}}}</script><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/main.css></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://HyoseungJeon.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://HyoseungJeon.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://HyoseungJeon.github.io/posts/ title=posts class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>posts</span></a></li><li><a href=https://HyoseungJeon.github.io/tags/ title=tags class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>tags</span></a></li><li><a href=https://HyoseungJeon.github.io/archives/ title=archives class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>archives</span></a></li><li><a href=https://HyoseungJeon.github.io/search/ title="search (Alt + /)" class=btn-12 accesskey=/><span style=font-family:SUITE-Regular;font-size:19px>search</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://HyoseungJeon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/java/>Java</a></div><h1 class=post-title>Cursor</h1><div class=post-meta><span title='2023-11-23 08:58:04 +0900 +0900'>November 23, 2023</span>&nbsp;·&nbsp;361 words&nbsp;·&nbsp;HyoSeung Jeon</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner style=padding-top:10px><ul><li><a href=#cursor%eb%9e%80 aria-label=Cursor란?>Cursor란?</a><ul><li><a href=#%ec%a0%95%ec%9d%98 aria-label=정의>정의</a></li><li><a href=#%ec%82%ac%ec%9a%a9%eb%b2%95 aria-label=사용법>사용법</a></li><li><a href=#%ec%a4%91%ec%9a%94-%ed%8f%ac%ec%9d%b8%ed%8a%b8 aria-label="중요 포인트">중요 포인트</a></li></ul></li><li><a href=#%eb%82%b4-%ec%83%9d%ea%b0%81 aria-label="내 생각">내 생각</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?(document.getElementById("toc-container").classList.add("wide"),document.getElementById("menu-container").style.display=""):(document.getElementById("toc-container").classList.remove("wide"),document.getElementById("menu-container").style.display="none")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css><link rel=stylesheet href=https://unpkg.com/css-pro-layout@1.1.0/dist/css/css-pro-layout.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"><script src=https://unpkg.com/@popperjs/core@2></script><div id=menu-container class="layout toc-container wide-r"><aside id=sidebar class="sidebar break-point-sm has-bg-image" style=width:100%;position:sticky;top:var(--gap)><div class=sidebar-layout><div class=sidebar-content><nav class="menu open-current-submenu"><ul><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>API
<span class=menu-title-suffix>(4)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/api/fcm/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>FCM</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice 본인인증</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%91/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증 이슈대응</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증이슈대응2</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Chrome
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/chrome/debug/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Debug</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Design Patterns
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Behavioral Patterns
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/designpattern/behavioral-patterns/strategypattern/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Strategy Pattern</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class=menu-item><a href=/posts/designpattern/creational-patterns/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Creational Patterns</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/designpattern/structural-patterns/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Structural Patterns</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>ETC
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>MSA 환경 TraceId Logging</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/etc/oauth/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>OAuth</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Intellij
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/intellij/propertiesautoupper/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Properties Auto Upper</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/intellij/thymeleaf/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Thymeleaf</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java
<span class=menu-title-suffix>(7)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/java/cursor/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Cursor</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/file/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>File</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/function-package/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Function Package</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/future/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Future</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/generic/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Generic</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/reflection/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Reflection</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/synchronized/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Synchronized</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java Script
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/javascript/validate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Custom Validate</span>
<span class=menu-suffix></span></a></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Date
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/javascript/date/setdate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>setDate</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class=menu-item><a href=/posts/javascript/pagereloadissue/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Page Reload Issue</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>JQuery
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/jquery/validate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>JQuery Validate</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/jquery/ztree/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>ZTree</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Spring
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/spring/async/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Async</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/spring/requestcontextholder/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>RequestContextHolder</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/spring/springsecurity/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Spring Security</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>SQL
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/sql/withrecursive/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>With Recursive</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Window
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/window/nud%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%88%84%EC%88%98/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nud 메모리누수</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>독후감
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/cleanarchitecture/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Clean Architecture</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/%ED%95%A8%EC%88%98%ED%98%95%EC%BD%94%EB%94%A9/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>쏙쏙 들어오는 함수형 코딩</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>일기장
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/%EC%9D%BC%EA%B8%B0%EC%9E%A5/23-07-18/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>23.07.18</span>
<span class=menu-suffix></span></a></li></ul></div></li><ul></nav></div></div><div class=sidebar-footer><div class=footer-box><div></div><div style="padding:0 10px"><span style=display:block;margin-bottom:10px>Pro sidebar is also available as a react package</span><div style=margin-bottom:15px><img alt="preview badge" src="https://img.shields.io/github/stars/azouaoui-med/react-pro-sidebar?style=social"></div><div><a href=https://github.com/azouaoui-med/react-pro-sidebar target=_blank>Check it out!</a></div></div></div></div></aside></div><style scoped></style><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/pro-sidebar.css><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition()},!1),window.addEventListener("resize",function(){checkTocPosition()},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("menu-container").style.display="":document.getElementById("menu-container").style.display="none"}</script><div class=post-content><hr><style>#callout{background:#f1f1ef;padding:1.5em 1.25em;border-radius:3px;display:flex;flex-direction:row;margin-bottom:20px;color:var(--hljs-bg)}#callout-inner{margin-left:1em;white-space:pre-line}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡</div><div id=callout-inner>Batch 개발을 하는 도중 다른 job 소스를 참고하는데 엄청나게 많은 데이터를 읽어오는 reader 단을 짠 소스를 보았다..!! 이거 이렇게 읽어와도.. 문제가 없나?? 라는 생각이 들었고 내부 소스를 확인해보니.. Cursor 란 친구로 데이터를 읽어오고 있었다! 이전에 본 적이 없는 Class 였다!! 이 친구가 문제를 해결해 주고 있는 것 같아 내용이 궁금해져서 찾아보게 되었다!!</div></div><h2 id=cursor란>Cursor란?<a hidden class=anchor aria-hidden=true href=#cursor란>#</a></h2><h3 id=정의>정의<a hidden class=anchor aria-hidden=true href=#정의>#</a></h3><blockquote><p>Cursor contract to handle fetching items lazily using an Iterator. Cursors are a perfect fit to handle millions of items queries that would not normally fit in memory. If you use collections in resultMaps then cursor SQL queries must be ordered (resultOrdered=&ldquo;true&rdquo;) using the id columns of the resultMap.
출처 - <a href=https://mybatis.org/mybatis-3/apidocs/org/apache/ibatis/cursor/Cursor.html>https://mybatis.org/mybatis-3/apidocs/org/apache/ibatis/cursor/Cursor.html</a></p></blockquote><p>짧게 요약하면 Lazy loading 이라고 할 수 있을 것 같다.</p><p>Iterator를 사용하여 데이터를 천천히 적재하여 처리할 수 있도록 돕는 interface 이다.</p><h3 id=사용법>사용법<a hidden class=anchor aria-hidden=true href=#사용법>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=nd>@Transactional</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>processDummyDataList</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>mapper</span><span class=o>.</span><span class=na>getDummyDataList</span><span class=o>().</span><span class=na>forEach</span><span class=o>(</span><span class=n>el</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// 처리
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>})</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// ~~~
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Mapper</span>
</span></span><span class=line><span class=cl><span class=n>Cursor</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>getDummyDataList</span><span class=o>();</span>
</span></span></code></pre></div><p>사용법은 굉장히 간단하다! List Class로 조회하던 부분을 Cursor로 바꾸어서 사용하면 끝이다..! 하면 DB의 option에 따라 (fetchSize) data를 가져오고 처리하는 방식으로 동작한다!</p><style>#callout{background:#f1f1ef;padding:1.5em 1.25em;border-radius:3px;display:flex;flex-direction:row;margin-bottom:20px;color:var(--hljs-bg)}#callout-inner{margin-left:1em;white-space:pre-line}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>❗</div><div id=callout-inner>단, Cursor는 데이터를 지속적으로 읽어오기 위해 DB Conntetion이 유지되어야 한다!
하여 @Transaction 어노테이션을 선언해 주어야 한다!</div></div><h3 id=중요-포인트>중요 포인트<a hidden class=anchor aria-hidden=true href=#중요-포인트>#</a></h3><p>결국 이 서버의 fetchSize를 각 환경을 고려해서 적절하게 선언하는 것이 중요하다고 보인다!! 사용하는 서버의 메모리 용량, 평소 사용량, 필요한 속도, 네트워크의 사양 등등 다양한 요소를 고려하여 값을 설정할 필요성이 있다!</p><p>fetchSize가 크다면, 메모리의 적재량이 커지고, 처리 시간이 빨라질 것 이다.
fetchSize가 작다면, 메모리의 적재량은 줄지만, 처리 시간은 늘어날 것 이다.</p><h2 id=내-생각>내 생각<a hidden class=anchor aria-hidden=true href=#내-생각>#</a></h2><p>확실히 Batch Server와 성격이 잘 맞는 것 같다! 빠른 응답보단 에러 없이 안전하게 데이터를 처리해 주는 것이 더 중요한 서버에 필요한 기능 같다!! 특히나 대용량의 데이터를 처리해야 하기 때문에 OOM을 염려할 수 밖에 없을텐데 이에서 완벽하게 벗어날 수 있다는 것이 매우 큰 안정성을 가져 오는 것 같다!</p><p>이러한 Class가.. mybatis에서 꽤나 오랫동안 존재했던 소스라는게 조금 신기했다..! 항상 Spring을 통하여 쉽게 사용했던 Mybatis 였는데.. 이러한 <code>Persistence Framework</code>에 집중해본 것은 처음이였다! JPA를 통해서 공부를 할 때에는 해당 동작 원리 등에 대하여 학습하였는데 정작 실 업무에서 사용하는 mybatis에 대해서는 조금 무지했지 않았나.. 라는 생각을 들게 했다 😅😅 이번 기회로 또 넓은 방향의 생각을 갖게 됐으니 그만이지 싶다..! 🙄</p><p>출처
<a href=https://mybatis.org/mybatis-3/apidocs/org/apache/ibatis/cursor/Cursor.html>Cursor (mybatis 3.5.15 API)</a>
<a href=https://joon2974.tistory.com/30>Cursor</a>
<a href=https://nidev.gitlab.io/2020/12/14/Mybatis%EC%9D%98-fetchSize%EC%99%80-Cursor-%EC%9D%B4%EC%95%BC%EA%B8%B0/>MyBatis의 fetchSize와 Cursor 이야기</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://HyoseungJeon.github.io/tags/java/>Java</a></li><li><a href=https://HyoseungJeon.github.io/tags/mybatis/>Mybatis</a></li><li><a href=https://HyoseungJeon.github.io/tags/persistence-framework/>Persistence Framework</a></li></ul><nav class=paginav><a class=prev href=https://HyoseungJeon.github.io/posts/etc/oauth/><span class=title>« Prev</span><br><span>OAuth</span></a>
<a class=next href=https://HyoseungJeon.github.io/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/><span class=title>Next »</span><br><span>MSA 환경 TraceId Logging</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://HyoseungJeon.github.io/>HyoSeung IT blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>