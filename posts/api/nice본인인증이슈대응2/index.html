<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nice본인인증이슈대응2 | HyoSeung IT blog</title><meta name=keywords content="JavaScript,Authentication"><meta name=description content="Nice본인인증 이슈2 문제 본인인증 기능이 운영기에 배포 후 얼마 지나지 않아 특정 사용자가 인증에 지속적으로 실패하는 문제가 발생했다!
원인 Kibana Log를 살펴본 결과 Nice의 본인인증 완료 후 화면에 encoding Data를 받아 복호화 하는 과정중에 에러가 발생했다! 그리고 복호화 실패의 원인은 유효한 encoding Data가 아닌 값을 받아 발생하였다.
하여 해당 사용자의 request URI를 기준으로 local에서 test 해본 결과 encdoing Data가 변조 되어 controller 단에서 받아 문제가 생겼다! 하여 변조된 과정을 따라가보니 Nice 본인인증에서 Get 방식으로 URI에 data를 담아 보내주는데, base64 encoding 방식을 사용하여 특수문자가 포함된 param을 보내고 있었다!"><meta name=author content="HyoSeung Jeon"><link rel=canonical href=https://HyoseungJeon.github.io/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://HyoseungJeon.github.io/profile.png><link rel=icon type=image/png sizes=16x16 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><script defer crossorigin=anonymous src=/js/pro.sidebar.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Nice본인인증이슈대응2"><meta property="og:description" content="Nice본인인증 이슈2 문제 본인인증 기능이 운영기에 배포 후 얼마 지나지 않아 특정 사용자가 인증에 지속적으로 실패하는 문제가 발생했다!
원인 Kibana Log를 살펴본 결과 Nice의 본인인증 완료 후 화면에 encoding Data를 받아 복호화 하는 과정중에 에러가 발생했다! 그리고 복호화 실패의 원인은 유효한 encoding Data가 아닌 값을 받아 발생하였다.
하여 해당 사용자의 request URI를 기준으로 local에서 test 해본 결과 encdoing Data가 변조 되어 controller 단에서 받아 문제가 생겼다! 하여 변조된 과정을 따라가보니 Nice 본인인증에서 Get 방식으로 URI에 data를 담아 보내주는데, base64 encoding 방식을 사용하여 특수문자가 포함된 param을 보내고 있었다!"><meta property="og:type" content="article"><meta property="og:url" content="https://HyoseungJeon.github.io/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/"><meta property="og:image" content="https://HyoseungJeon.github.io/profile2.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-15T09:41:20+09:00"><meta property="article:modified_time" content="2023-09-15T09:41:20+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://HyoseungJeon.github.io/profile2.png"><meta name=twitter:title content="Nice본인인증이슈대응2"><meta name=twitter:description content="Nice본인인증 이슈2 문제 본인인증 기능이 운영기에 배포 후 얼마 지나지 않아 특정 사용자가 인증에 지속적으로 실패하는 문제가 발생했다!
원인 Kibana Log를 살펴본 결과 Nice의 본인인증 완료 후 화면에 encoding Data를 받아 복호화 하는 과정중에 에러가 발생했다! 그리고 복호화 실패의 원인은 유효한 encoding Data가 아닌 값을 받아 발생하였다.
하여 해당 사용자의 request URI를 기준으로 local에서 test 해본 결과 encdoing Data가 변조 되어 controller 단에서 받아 문제가 생겼다! 하여 변조된 과정을 따라가보니 Nice 본인인증에서 Get 방식으로 URI에 data를 담아 보내주는데, base64 encoding 방식을 사용하여 특수문자가 포함된 param을 보내고 있었다!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://HyoseungJeon.github.io/posts/"},{"@type":"ListItem","position":2,"name":"API","item":"https://HyoseungJeon.github.io/posts/api/"},{"@type":"ListItem","position":3,"name":"Nice본인인증이슈대응2","item":"https://HyoseungJeon.github.io/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nice본인인증이슈대응2","name":"Nice본인인증이슈대응2","description":"Nice본인인증 이슈2 문제 본인인증 기능이 운영기에 배포 후 얼마 지나지 않아 특정 사용자가 인증에 지속적으로 실패하는 문제가 발생했다!\n원인 Kibana Log를 살펴본 결과 Nice의 본인인증 완료 후 화면에 encoding Data를 받아 복호화 하는 과정중에 에러가 발생했다! 그리고 복호화 실패의 원인은 유효한 encoding Data가 아닌 값을 받아 발생하였다.\n하여 해당 사용자의 request URI를 기준으로 local에서 test 해본 결과 encdoing Data가 변조 되어 controller 단에서 받아 문제가 생겼다! 하여 변조된 과정을 따라가보니 Nice 본인인증에서 Get 방식으로 URI에 data를 담아 보내주는데, base64 encoding 방식을 사용하여 특수문자가 포함된 param을 보내고 있었다!","keywords":["JavaScript","Authentication"],"articleBody":" Nice본인인증 이슈2 문제 본인인증 기능이 운영기에 배포 후 얼마 지나지 않아 특정 사용자가 인증에 지속적으로 실패하는 문제가 발생했다!\n원인 Kibana Log를 살펴본 결과 Nice의 본인인증 완료 후 화면에 encoding Data를 받아 복호화 하는 과정중에 에러가 발생했다! 그리고 복호화 실패의 원인은 유효한 encoding Data가 아닌 값을 받아 발생하였다.\n하여 해당 사용자의 request URI를 기준으로 local에서 test 해본 결과 encdoing Data가 변조 되어 controller 단에서 받아 문제가 생겼다! 하여 변조된 과정을 따라가보니 Nice 본인인증에서 Get 방식으로 URI에 data를 담아 보내주는데, base64 encoding 방식을 사용하여 특수문자가 포함된 param을 보내고 있었다! 헌데 사용자의 정보를 통한 encoding 값에 특수문자가 포함이 되고, api를 통해 값을 받을 때 “+”특수 문자가 공백(space)로 치환되서 넘어오고 있었다!\n하여 “+” 문자의 “space” 치환으로 인한 데이터 변조에 의해 문제가 발생하고 있었다. 특정 사용자에게만 문제가 발생한 이유도 해당 사용자의 encoding 값에 “+” 특수문자의 포함 여부에 달려있어 그랬던 것이였다…\n해결방법 우선 해당 URI param Data에 대한 변조는 담당 모듈 측에서 확인을 해주기로 했다! 그리고 내가 구현한 redirect api 에서는 해당 encoding Data의 변조에 대응하기 위해 공백을 다시 “+”로 치환해주는 로직을 추가하였다!! (사실 내가 또 변조하는 소스가 있어도 되는지 의구심은 든다..)\nString encodeData = originEncodeData.replaceAll(\" \", \"+\"); 내 생각 어쨌든 터질 문제였다고 생각한다!! 해당 기능을 구현할 당시에도 Nice Doc 에서는 이미 jsp 방식의 구현 guide를 제공하고 있지 않았다! (아무리 찾아도 내용이 없었다..)\nNice는 key 발급을 통한 RestAPI 방식으로 서비스를 제공하고 있었다! 해당 방식으로 인증 부분을 구현했다면.. 발생했던 여러 issue들이 다 발생하지 않았을 텐데.. 결국 너무 날 것의 방식으로 구현된 소스가 결합도를 의도치 않게 높여 다양한 문제가 발생한 것 같다..\n하지만!! issue 통해 또 정보를 배우는 것 아니겠나..!\nURI를 통한 param Data를 주고 받는 과정에서 우리는 특수문자나 공백에 대한 제약사항이 있다! 하여 encoding, decoding 하는 과정에 대한 부분을 신경 써야 한다! “%20”이나 “+” 관하여 request filter 단에서 처리하는 것 같은데 (내 유추이다) 이 사실이 존재했다는 것과 그 과정을 이해하게 되었다!\n내가 짚고 싶은 점은 2개 인 것 같다!\n코드화 된 Data는 Get 방식으로 주고 받는게 조금 위험해 보인다..! 물론 이미 암호화된 Data라면 간단하게 GET 방식으로 의사소통 하는게 가벼워 보이고 좋지만! 그 과정 속에 URL String? 이라는 환경에 갇혀서 하게 되고, 만약 encoding 된 값이 대응하기 어려운 특수문자 같은 것들이 존재한다면 우리는 그 과정에 대해 대응을 해야 하는 업무량이 생긴다! (물론 일반적인 경우는 Spring이 다 해주는 것 같다..)\n두번째론 URI의 특수문자 관련한 encoding 과정에 대한 지식이 생겼다! 어찌 보면 당연하긴 한데 간과하고 있었던 영역이기도 하다! 다시 한번 UTF-8 이나.. ISO-889~~ 등에 관련한 encoding 방식에 대해 어느 정도 기본적인 지식이 필요한 것 같다!\n","wordCount":"395","inLanguage":"en","datePublished":"2023-09-15T09:41:20+09:00","dateModified":"2023-09-15T09:41:20+09:00","author":{"@type":"Person","name":"HyoSeung Jeon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://HyoseungJeon.github.io/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/"},"publisher":{"@type":"Organization","name":"HyoSeung IT blog","logo":{"@type":"ImageObject","url":"https://HyoseungJeon.github.io/profile.png"}}}</script><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/main.css></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://HyoseungJeon.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://HyoseungJeon.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://HyoseungJeon.github.io/posts/ title=posts class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>posts</span></a></li><li><a href=https://HyoseungJeon.github.io/tags/ title=tags class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>tags</span></a></li><li><a href=https://HyoseungJeon.github.io/archives/ title=archives class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>archives</span></a></li><li><a href=https://HyoseungJeon.github.io/search/ title="search (Alt + /)" class=btn-12 accesskey=/><span style=font-family:SUITE-Regular;font-size:19px>search</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://HyoseungJeon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/api/>API</a></div><h1 class=post-title>Nice본인인증이슈대응2</h1><div class=post-meta><span title='2023-09-15 09:41:20 +0900 +0900'>September 15, 2023</span>&nbsp;·&nbsp;395 words&nbsp;·&nbsp;HyoSeung Jeon</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner style=padding-top:10px><ul><li><a href=#nice%eb%b3%b8%ec%9d%b8%ec%9d%b8%ec%a6%9d-%ec%9d%b4%ec%8a%882 aria-label="Nice본인인증 이슈2">Nice본인인증 이슈2</a><ul><li><a href=#%eb%ac%b8%ec%a0%9c aria-label=문제>문제</a></li><li><a href=#%ec%9b%90%ec%9d%b8 aria-label=원인>원인</a></li><li><a href=#%ed%95%b4%ea%b2%b0%eb%b0%a9%eb%b2%95 aria-label=해결방법>해결방법</a></li></ul></li><li><a href=#%eb%82%b4-%ec%83%9d%ea%b0%81 aria-label="내 생각">내 생각</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?(document.getElementById("toc-container").classList.add("wide"),document.getElementById("menu-container").style.display=""):(document.getElementById("toc-container").classList.remove("wide"),document.getElementById("menu-container").style.display="none")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css><link rel=stylesheet href=https://unpkg.com/css-pro-layout@1.1.0/dist/css/css-pro-layout.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"><script src=https://unpkg.com/@popperjs/core@2></script><div id=menu-container class="layout toc-container wide-r"><aside id=sidebar class="sidebar break-point-sm has-bg-image" style=width:100%;position:sticky;top:var(--gap)><div class=sidebar-layout><div class=sidebar-content><nav class="menu open-current-submenu"><ul><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>API
<span class=menu-title-suffix>(4)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/api/fcm/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>FCM</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice 본인인증</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%91/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증 이슈대응</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증이슈대응2</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Chrome
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/chrome/debug/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Debug</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Design Patterns
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Behavioral Patterns
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/designpattern/behavioral-patterns/strategypattern/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Strategy Pattern</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class=menu-item><a href=/posts/designpattern/creational-patterns/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Creational Patterns</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/designpattern/structural-patterns/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Structural Patterns</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>ETC
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>MSA 환경 TraceId Logging</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Intellij
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/intellij/propertiesautoupper/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Properties Auto Upper</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/intellij/thymeleaf/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Thymeleaf</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java
<span class=menu-title-suffix>(7)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/java/cursor/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Cursor</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/file/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>File</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/function-package/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Function Package</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/future/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Future</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/generic/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Generic</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/reflection/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Reflection</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/synchronized/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Synchronized</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java Script
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/javascript/validate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Custom Validate</span>
<span class=menu-suffix></span></a></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Date
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/javascript/date/setdate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>setDate</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class=menu-item><a href=/posts/javascript/pagereloadissue/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Page Reload Issue</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>JQuery
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/jquery/validate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>JQuery Validate</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/jquery/ztree/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>ZTree</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Spring
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/spring/async/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Async</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/spring/requestcontextholder/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>RequestContextHolder</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/spring/springsecurity/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Spring Security</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>SQL
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/sql/withrecursive/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>With Recursive</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Window
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/window/nud%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%88%84%EC%88%98/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nud 메모리누수</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>독후감
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/cleanarchitecture/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Clean Architecture</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/%ED%95%A8%EC%88%98%ED%98%95%EC%BD%94%EB%94%A9/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>쏙쏙 들어오는 함수형 코딩</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>일기장
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/%EC%9D%BC%EA%B8%B0%EC%9E%A5/23-07-18/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>23.07.18</span>
<span class=menu-suffix></span></a></li></ul></div></li><ul></nav></div></div><div class=sidebar-footer><div class=footer-box><div></div><div style="padding:0 10px"><span style=display:block;margin-bottom:10px>Pro sidebar is also available as a react package</span><div style=margin-bottom:15px><img alt="preview badge" src="https://img.shields.io/github/stars/azouaoui-med/react-pro-sidebar?style=social"></div><div><a href=https://github.com/azouaoui-med/react-pro-sidebar target=_blank>Check it out!</a></div></div></div></div></aside></div><style scoped></style><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/pro-sidebar.css><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition()},!1),window.addEventListener("resize",function(){checkTocPosition()},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("menu-container").style.display="":document.getElementById("menu-container").style.display="none"}</script><div class=post-content><hr><h2 id=nice본인인증-이슈2>Nice본인인증 이슈2<a hidden class=anchor aria-hidden=true href=#nice본인인증-이슈2>#</a></h2><h3 id=문제>문제<a hidden class=anchor aria-hidden=true href=#문제>#</a></h3><p>본인인증 기능이 운영기에 배포 후 얼마 지나지 않아 특정 사용자가 인증에 지속적으로 실패하는 문제가 발생했다!</p><h3 id=원인>원인<a hidden class=anchor aria-hidden=true href=#원인>#</a></h3><p>Kibana Log를 살펴본 결과 Nice의 본인인증 완료 후 화면에 encoding Data를 받아 복호화 하는 과정중에 에러가 발생했다! 그리고 복호화 실패의 원인은 유효한 encoding Data가 아닌 값을 받아 발생하였다.</p><p>하여 해당 사용자의 request URI를 기준으로 local에서 test 해본 결과 encdoing Data가 변조 되어 controller 단에서 받아 문제가 생겼다! 하여 변조된 과정을 따라가보니 Nice 본인인증에서 Get 방식으로 URI에 data를 담아 보내주는데, base64 encoding 방식을 사용하여 특수문자가 포함된 param을 보내고 있었다! 헌데 사용자의 정보를 통한 encoding 값에 특수문자가 포함이 되고, api를 통해 값을 받을 때 “+”특수 문자가 공백(space)로 치환되서 넘어오고 있었다!</p><p>하여 “+” 문자의 “space” 치환으로 인한 데이터 변조에 의해 문제가 발생하고 있었다. 특정 사용자에게만 문제가 발생한 이유도 해당 사용자의 encoding 값에 “+” 특수문자의 포함 여부에 달려있어 그랬던 것이였다…</p><h3 id=해결방법>해결방법<a hidden class=anchor aria-hidden=true href=#해결방법>#</a></h3><p>우선 해당 URI param Data에 대한 변조는 담당 모듈 측에서 확인을 해주기로 했다! 그리고 내가 구현한 redirect api 에서는 해당 encoding Data의 변조에 대응하기 위해 공백을 다시 “+”로 치환해주는 로직을 추가하였다!! (사실 내가 또 변조하는 소스가 있어도 되는지 의구심은 든다..)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nb>String</span> <span class=nx>encodeData</span> <span class=o>=</span> <span class=nx>originEncodeData</span><span class=p>.</span><span class=nx>replaceAll</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=s2>&#34;+&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=내-생각>내 생각<a hidden class=anchor aria-hidden=true href=#내-생각>#</a></h2><p>어쨌든 터질 문제였다고 생각한다!! 해당 기능을 구현할 당시에도 Nice Doc 에서는 이미 jsp 방식의 구현 guide를 제공하고 있지 않았다! (아무리 찾아도 내용이 없었다..)</p><p>Nice는 key 발급을 통한 RestAPI 방식으로 서비스를 제공하고 있었다! 해당 방식으로 인증 부분을 구현했다면.. 발생했던 여러 issue들이 다 발생하지 않았을 텐데.. 결국 너무 날 것의 방식으로 구현된 소스가 결합도를 의도치 않게 높여 다양한 문제가 발생한 것 같다..</p><p>하지만!! issue 통해 또 정보를 배우는 것 아니겠나..!</p><p>URI를 통한 param Data를 주고 받는 과정에서 우리는 특수문자나 공백에 대한 제약사항이 있다! 하여 encoding, decoding 하는 과정에 대한 부분을 신경 써야 한다! “%20”이나 “+” 관하여 request filter 단에서 처리하는 것 같은데 (내 유추이다) 이 사실이 존재했다는 것과 그 과정을 이해하게 되었다!</p><p>내가 짚고 싶은 점은 2개 인 것 같다!</p><p>코드화 된 Data는 Get 방식으로 주고 받는게 조금 위험해 보인다..! 물론 이미 암호화된 Data라면 간단하게 GET 방식으로 의사소통 하는게 가벼워 보이고 좋지만! 그 과정 속에 URL String? 이라는 환경에 갇혀서 하게 되고, 만약 encoding 된 값이 대응하기 어려운 특수문자 같은 것들이 존재한다면 우리는 그 과정에 대해 대응을 해야 하는 업무량이 생긴다! (물론 일반적인 경우는 Spring이 다 해주는 것 같다..)</p><p>두번째론 URI의 특수문자 관련한 encoding 과정에 대한 지식이 생겼다! 어찌 보면 당연하긴 한데 간과하고 있었던 영역이기도 하다! 다시 한번 UTF-8 이나.. ISO-889~~ 등에 관련한 encoding 방식에 대해 어느 정도 기본적인 지식이 필요한 것 같다!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://HyoseungJeon.github.io/tags/javascript/>JavaScript</a></li><li><a href=https://HyoseungJeon.github.io/tags/authentication/>Authentication</a></li></ul><nav class=paginav><a class=prev href=https://HyoseungJeon.github.io/posts/window/nud%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%88%84%EC%88%98/><span class=title>« Prev</span><br><span>Nud 메모리누수</span></a>
<a class=next href=https://HyoseungJeon.github.io/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%91/><span class=title>Next »</span><br><span>Nice본인인증 이슈대응</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://HyoseungJeon.github.io/>HyoSeung IT blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>