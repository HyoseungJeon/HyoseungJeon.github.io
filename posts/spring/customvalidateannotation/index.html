<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Custom Validate Annotation | HyoSeung IT blog</title><meta name=keywords content="Spring,Validate,Java,Annotation"><meta name=description content="💡 프로젝트가 자체 Migration 작업을 하고 있다! 하여 다른 모듈에서 공통 코드를 Enum화 하기 시작했는데, 그 중 interface Class를 통하여 공통코드를 관리하게 작업하였다! 나 또한 새로운 작업 때문에 유효성 검증 로직에 공통코드 검증 로직의 추가가 필요 했는데 해당 interface를 활용하여 @Valid 작업을 통해 간편하게 검증을 하면 좋겠다고 생각하여 해당 작업을 하게 됐다!! 😁😁 한번 만들어보자~~ 문제 정의 현재 공통코드 값으로 검증하는 로직은 각자 정적인 방식으로 검증하는 로직을 사용하거나 검증을 하지 않고 있다."><meta name=author content="HyoSeung Jeon"><link rel=canonical href=https://HyoseungJeon.github.io/posts/spring/customvalidateannotation/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://HyoseungJeon.github.io/profile.png><link rel=icon type=image/png sizes=16x16 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><script defer crossorigin=anonymous src=/js/pro.sidebar.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Custom Validate Annotation"><meta property="og:description" content="💡 프로젝트가 자체 Migration 작업을 하고 있다! 하여 다른 모듈에서 공통 코드를 Enum화 하기 시작했는데, 그 중 interface Class를 통하여 공통코드를 관리하게 작업하였다! 나 또한 새로운 작업 때문에 유효성 검증 로직에 공통코드 검증 로직의 추가가 필요 했는데 해당 interface를 활용하여 @Valid 작업을 통해 간편하게 검증을 하면 좋겠다고 생각하여 해당 작업을 하게 됐다!! 😁😁 한번 만들어보자~~ 문제 정의 현재 공통코드 값으로 검증하는 로직은 각자 정적인 방식으로 검증하는 로직을 사용하거나 검증을 하지 않고 있다."><meta property="og:type" content="article"><meta property="og:url" content="https://HyoseungJeon.github.io/posts/spring/customvalidateannotation/"><meta property="og:image" content="https://HyoseungJeon.github.io/profile2.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-22T10:39:08+09:00"><meta property="article:modified_time" content="2024-04-22T10:39:08+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://HyoseungJeon.github.io/profile2.png"><meta name=twitter:title content="Custom Validate Annotation"><meta name=twitter:description content="💡 프로젝트가 자체 Migration 작업을 하고 있다! 하여 다른 모듈에서 공통 코드를 Enum화 하기 시작했는데, 그 중 interface Class를 통하여 공통코드를 관리하게 작업하였다! 나 또한 새로운 작업 때문에 유효성 검증 로직에 공통코드 검증 로직의 추가가 필요 했는데 해당 interface를 활용하여 @Valid 작업을 통해 간편하게 검증을 하면 좋겠다고 생각하여 해당 작업을 하게 됐다!! 😁😁 한번 만들어보자~~ 문제 정의 현재 공통코드 값으로 검증하는 로직은 각자 정적인 방식으로 검증하는 로직을 사용하거나 검증을 하지 않고 있다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://HyoseungJeon.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Spring","item":"https://HyoseungJeon.github.io/posts/spring/"},{"@type":"ListItem","position":3,"name":"Custom Validate Annotation","item":"https://HyoseungJeon.github.io/posts/spring/customvalidateannotation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Custom Validate Annotation","name":"Custom Validate Annotation","description":"💡 프로젝트가 자체 Migration 작업을 하고 있다! 하여 다른 모듈에서 공통 코드를 Enum화 하기 시작했는데, 그 중 interface Class를 통하여 공통코드를 관리하게 작업하였다! 나 또한 새로운 작업 때문에 유효성 검증 로직에 공통코드 검증 로직의 추가가 필요 했는데 해당 interface를 활용하여 @Valid 작업을 통해 간편하게 검증을 하면 좋겠다고 생각하여 해당 작업을 하게 됐다!! 😁😁 한번 만들어보자~~ 문제 정의 현재 공통코드 값으로 검증하는 로직은 각자 정적인 방식으로 검증하는 로직을 사용하거나 검증을 하지 않고 있다.","keywords":["Spring","Validate","Java","Annotation"],"articleBody":" 💡 프로젝트가 자체 Migration 작업을 하고 있다! 하여 다른 모듈에서 공통 코드를 Enum화 하기 시작했는데, 그 중 interface Class를 통하여 공통코드를 관리하게 작업하였다! 나 또한 새로운 작업 때문에 유효성 검증 로직에 공통코드 검증 로직의 추가가 필요 했는데 해당 interface를 활용하여 @Valid 작업을 통해 간편하게 검증을 하면 좋겠다고 생각하여 해당 작업을 하게 됐다!! 😁😁 한번 만들어보자~~ 문제 정의 현재 공통코드 값으로 검증하는 로직은 각자 정적인 방식으로 검증하는 로직을 사용하거나 검증을 하지 않고 있다.\n하여 사용하지 않는 코드 값이 들어갈 가능성이 존재하고, 작업자로 하여금 코드 값을 검증하는 코드를 정적으로 끼워 넣는 경우가 다수 발생하고 있다. 그 결과로 코드 값에 관련한 프로세스를 한 눈에 보기 어렵고 유지보수에 애로사항이 생기게 되었다.\n해결 방안 기존의 몇몇 모듈에서는 Spring의 @Validated Annotation 기능을 활용하여 유효성 검증을 하고 있다! 간단하게 몇몇 Annotation을 통해서 검증을 할 수 있어서 편리해 사용하고 있다. 하여 위의 Annotation의 동작을 통하여 공통코드 Field 값 또한 검증을 하면 좋겠다는 생각에서 접근하게 됐다!\n@Validated로 동작하는 Custom Validator Annotation을 만든다! value 값으로 공통코드 interface로 구현된 Enum Class를 받아 간단하게 검증 프로세스를 추가할 수 있도록 한다.\n작업 내용 CommonCode Annotation\n기본적으로 javax.validation package의 Validate Annotaion 형태를 구현한다!\n@Target - Annotation 적용 범위 설정 @Rentention - Annotaion 유지 범위 설정 @Constraint - 검증 Class 설정 (ConstraintValidator class 구현체) message - 검증 실패 시 return 문구 groups - 수행할 그룹 지정 payload - 검증 수행 클라이언트에서 사용 가능한 메타 데이터 지정 참고 단, target은 Field 만으로 설정한다.\n추가로 공통코드 interface Class를 Field 값으로 추가한다!\n검증 프로세스를 수행하는 ConstraintValidator(CommonCodeValidator)를 주입한다.\n@Target(ElementType.FIELD) @Retention(RetentionPolicy.RUNTIME) @Constraint(validatedBy = CommonCodeValidator.class) public @interface CommonCode { String message() default \"Not contain.\"; Class\u003c?\u003e[] groups() default {}; Class\u003c? extends Payload\u003e[] payload() default {}; Class\u003c? extends CommonCode\u003e commonCodeClass() default CommonCode.class; } CommonCodeValidator (implements ConstraintValidator)\nConstraintValidator 를 구현한다!\n위 Annotaion이 선언된 field 값 검증을 수행한다! Annotaion에 정의한 Enum Class 내의 Code값 중 동일한 값이 없다면 검증에 실패한다.\n단, empty Text는 제외한다. 구현체가 없는 Class 정의 시 통과되지 않는다. (Warn log를 남긴다) @Slf4j public class CommonCodeValidator implements ConstraintValidator\u003cCommonCode, String\u003e { private Class\u003c? extends CommonCode\u003e commonCodeClass; @Override public void initialize(CommonCode constraintAnnotation) { ConstraintValidator.super.initialize(constraintAnnotation); commonCodeClass = constraintAnnotation.commonCodeClass(); } @Override public boolean isValid(String str, ConstraintValidatorContext constraintValidatorContext) { if (!StringUtils.hasText(str)) return true; if (!isEnumSubclass(commonCodeClass)){ log.warn(\"It's not CommonCode's Enum class.\"); return false; } CommonCode[] enumConstants = commonCodeClass.getEnumConstants(); return Arrays.stream(enumConstants).anyMatch(el-\u003e str.equals(el.getCode())); } private boolean isEnumSubclass(Class\u003c?\u003e clazz) { return Enum.class.equals(clazz.getSuperclass()); } } ❗ interface class를 그대로 주입하는 경우, value 값을 지정하지 않은 경우를 보완하기 위해 Enum class인지 체크하는 프로세스를 통해 위 경우를 방지한다!\nCommonCode (참고)\nString getCode() inteface method를 통하여 code값을 꺼내 비교한다.\n사용 예 적용 할 Entity, DTO class에 해당 Annotaion을 선언하고, 검증 할 enum Class를 작성한다!\n@Getter @Setter public class entityClass { // ~~~~~~ @CommonCode(commonCodeClass = TEST101.class) public String testCommonCode; // ~~~~~~ } 알게된 점 CommonCodeValidator 를 정의할 때에 Annotation에 선언한 value 값을 가져오는 부분이 어려웠다! 해당 Validator가 Singleton pattern으로 사용될 것이라고 생각해서 자연스럽게 isValid method 부분에서 context에 현재 선언된 Enum class 를 받아와 검증할 것이라고 생각했다!\n하지만 내용을 찾아본 결과 값을 참조하는 방식이 해당 class의 멤버 변수로 선언하고 init 시점에 주입하여 사용한다는 것이였다!!! 🤔🤔\n하여 이 방식이 궁금하여 debugging을 돌려본 결과.. 해당 Validator은 선언한 value값을 key로 하여 n개 만큼 생성되고 동작한다는 것이였다!! 🤣\n혹시나 하여 다른 @Size 등의 기본 Annotation 소스를 살펴본 결과.. 똑같았다..!! 당연하게 Singleton pattern을 사용하여 자원을 아껴 동작할 줄 알았는데..? 예상과 달라 당황스러웠지만..! 그래도 내부 동작 방식에 대해 조금 더 이해하게 되어 좋았다!!\n하여 최종적으로는 해당 Validator이 사용한 Enum class 만큼 늘어날 수 있다는 정보를 얻었다!! 실제로 이 내용에 대해 Memory 점유 문제가 걱정되어 검색을 해봤지만, 왠만한 size로는 부하를 줄 정도로는 점유하지 않는다고 한다..! (그냥 요즘 서버 Spec이 좋아져서 그런 것 같다!!)\n추가적으로 Custom Annotation을 정의하는 부분은 검색 시 쉽게 찾아볼 수 있다! 이는 다른 글에서 정리해서 다시 올려야겠다..\n내 생각 사실 유효성 검증 로직은 어느 비즈니스, 어떤 모듈이건 다 공통적으로 무조건 들어가는 프로세스 중 하나 이다! 어떻게 보면 Back-end 에서 가장 기본이 되는 부분이기도 하다. 사실 이 부분을 Annotation을 통해 간단하게 설정하면 매우 좋지만! 특수한 여러 케이스의 경우는 사용이 불가능한 경우도 있어 service 단에서 따로 작업을 했었다..!\n헌데 위와 같이 간단하게 코드 데이터를 쉽게 검증하는 Annotation을 추가하니 매우 작업이 편해졌다..! 결국 위 로직을 통해 DB에 정의된 Code 이외의 값이 들어갈 가능성이 아예 사라진 것이니 데이터의 무결성이 한층 높아진 것 아닐까..? (물론 Service 영역에서 말이고 DB 영역은 논외다! 착각 ㄴㄴ..😅)\n위 과정을 통해 Entity Class에서 DDL의 대부분 role이 mapping 되서 정의할 수 있다는 장점도 좋은 것 같다! 물론 주석으로 공통코드 name을 mapping 해두는 아름다운 작업자들도 있지만.. 그런 소스나 글이 전혀 없어 한참 추적하여 해당 cd값에 맞는 공통코드를 찾아가는 경우도 있었다..! 하여 해당하는 Classs를 정의하는 곳에 직접 주입하니, 유지/보수 과정에서도 작업 시간이 훨씬 단축된 듯 하였다!\n사실상 Custom Annotation은 활용 영역이 무궁무진 한 것 같다..! 지금까지 활용해본 예는 Masking, Validate 등이 전부지만 남발하지 않는 선에서의 활용은 프로젝트 관리 측면에서는 매우 이점이 많을 것 같다!! 다른 기능도 조금씩 구현해보자..!! 😋\n참고 Spring MVC Custom Validation | Baeldung (Spring Boot) Custom Validator 적용하는 방법, 단일 및 다중 필드 [Spring] 45. Spring Validation을 이용한 유효성 검증(2) - @Constraint, ConstraintValidator\n","wordCount":"801","inLanguage":"en","datePublished":"2024-04-22T10:39:08+09:00","dateModified":"2024-04-22T10:39:08+09:00","author":{"@type":"Person","name":"HyoSeung Jeon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://HyoseungJeon.github.io/posts/spring/customvalidateannotation/"},"publisher":{"@type":"Organization","name":"HyoSeung IT blog","logo":{"@type":"ImageObject","url":"https://HyoseungJeon.github.io/profile.png"}}}</script><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/main.css></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://HyoseungJeon.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://HyoseungJeon.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://HyoseungJeon.github.io/posts/ title=posts class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>posts</span></a></li><li><a href=https://HyoseungJeon.github.io/tags/ title=tags class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>tags</span></a></li><li><a href=https://HyoseungJeon.github.io/archives/ title=archives class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>archives</span></a></li><li><a href=https://HyoseungJeon.github.io/search/ title="search (Alt + /)" class=btn-12 accesskey=/><span style=font-family:SUITE-Regular;font-size:19px>search</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://HyoseungJeon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/spring/>Spring</a></div><h1 class=post-title>Custom Validate Annotation</h1><div class=post-meta><span title='2024-04-22 10:39:08 +0900 +0900'>April 22, 2024</span>&nbsp;·&nbsp;801 words&nbsp;·&nbsp;HyoSeung Jeon</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner style=padding-top:10px><ul><li><a href=#%eb%ac%b8%ec%a0%9c-%ec%a0%95%ec%9d%98 aria-label="문제 정의">문제 정의</a></li><li><a href=#%ed%95%b4%ea%b2%b0-%eb%b0%a9%ec%95%88 aria-label="해결 방안">해결 방안</a></li><li><a href=#%ec%9e%91%ec%97%85-%eb%82%b4%ec%9a%a9 aria-label="작업 내용">작업 내용</a><ul><li><a href=#%ec%82%ac%ec%9a%a9-%ec%98%88 aria-label="사용 예">사용 예</a></li></ul></li><li><a href=#%ec%95%8c%ea%b2%8c%eb%90%9c-%ec%a0%90 aria-label="알게된 점">알게된 점</a></li><li><a href=#%eb%82%b4-%ec%83%9d%ea%b0%81 aria-label="내 생각">내 생각</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?(document.getElementById("toc-container").classList.add("wide"),document.getElementById("menu-container").style.display=""):(document.getElementById("toc-container").classList.remove("wide"),document.getElementById("menu-container").style.display="none")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css><link rel=stylesheet href=https://unpkg.com/css-pro-layout@1.1.0/dist/css/css-pro-layout.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"><script src=https://unpkg.com/@popperjs/core@2></script><div id=menu-container class="layout toc-container wide-r"><aside id=sidebar class="sidebar break-point-sm has-bg-image" style=width:100%;position:sticky;top:var(--gap)><div class=sidebar-layout><div class=sidebar-content><nav class="menu open-current-submenu"><ul><li class="menu-item sub-menu" name=API data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>API
<span class=menu-title-suffix>(4)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=FCM data-level=1><a href=/posts/api/fcm/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>FCM</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Nice 본인인증" data-level=1><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice 본인인증</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Nice본인인증 이슈대응" data-level=1><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%91/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증 이슈대응</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Nice본인인증이슈대응2 data-level=1><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증이슈대응2</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Chrome data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Chrome
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=Debug data-level=1><a href=/posts/chrome/debug/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Debug</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name="Design Pattern" data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Design Pattern
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item sub-menu" name="Behavioral Patterns" data-level=1><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Behavioral Patterns
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Strategy Pattern" data-level=2><a href=/posts/designpattern/behavioralpatterns/strategypattern/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Strategy Pattern</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item page-menu" name="Creational Patterns" data-level=1><a href=/posts/designpattern/creationalpatterns/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Creational Patterns</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Structural Patterns" data-level=1><a href=/posts/designpattern/structuralpatterns/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Structural Patterns</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=ETC data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>ETC
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="MSA Id Auditing" data-level=1><a href=/posts/etc/msaidauditing/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>MSA Id Auditing</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="MSA 환경 TraceId Logging" data-level=1><a href=/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>MSA 환경 TraceId Logging</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=OAuth data-level=1><a href=/posts/etc/oauth/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>OAuth</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=HTML data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>HTML
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Page Reload Issue" data-level=1><a href=/posts/html/pagereloadissue/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Page Reload Issue</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Page Reload Issue 2" data-level=1><a href=/posts/html/pagereloadissue2/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Page Reload Issue 2</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Intellij data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Intellij
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Properties Auto Upper" data-level=1><a href=/posts/intellij/propertiesautoupper/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Properties Auto Upper</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Thymeleaf data-level=1><a href=/posts/intellij/thymeleaf/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Thymeleaf</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Java data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java
<span class=menu-title-suffix>(9)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Blocking Queue" data-level=1><a href=/posts/java/blockingqueue/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Blocking Queue</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Cursor data-level=1><a href=/posts/java/cursor/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Cursor</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=File data-level=1><a href=/posts/java/file/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>File</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Function Package" data-level=1><a href=/posts/java/function-package/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Function Package</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Future data-level=1><a href=/posts/java/future/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Future</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Generic data-level=1><a href=/posts/java/generic/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Generic</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Reflection data-level=1><a href=/posts/java/reflection/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Reflection</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Synchronized data-level=1><a href=/posts/java/synchronized/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Synchronized</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Thread Local" data-level=1><a href=/posts/java/threadlocal/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Thread Local</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name="Java Script" data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java Script
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Custom Validate" data-level=1><a href=/posts/javascript/customvalidate/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Custom Validate</span>
<span class=menu-suffix></span></a></li><li class="menu-item sub-menu" name=Date data-level=1><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Date
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=setDate data-level=2><a href=/posts/javascript/date/setdate/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>setDate</span>
<span class=menu-suffix></span></a></li></ul></div></li></ul></div></li><li class="menu-item sub-menu" name=JQuery data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>JQuery
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="JQuery Validate" data-level=1><a href=/posts/jquery/validate/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>JQuery Validate</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=ZTree data-level=1><a href=/posts/jquery/ztree/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>ZTree</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Spring data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Spring
<span class=menu-title-suffix>(6)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=Async data-level=1><a href=/posts/spring/async/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Async</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Cache data-level=1><a href=/posts/spring/cache/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Cache</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Custom Validate Annotation" data-level=1><a href=/posts/spring/customvalidateannotation/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Custom Validate Annotation</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=RequestContextHolder data-level=1><a href=/posts/spring/requestcontextholder/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>RequestContextHolder</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name=Scope data-level=1><a href=/posts/spring/scope/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Scope</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="Spring Security" data-level=1><a href=/posts/spring/springsecurity/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Spring Security</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=SQL data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>SQL
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="With Recursive" data-level=1><a href=/posts/sql/withrecursive/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>With Recursive</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=Window data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Window
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Nud 메모리누수" data-level=1><a href=/posts/window/nud%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%88%84%EC%88%98/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nud 메모리누수</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=독후감 data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>독후감
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name="Clean Architecture" data-level=1><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/cleanarchitecture/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Clean Architecture</span>
<span class=menu-suffix></span></a></li><li class="menu-item page-menu" name="쏙쏙 들어오는 함수형 코딩" data-level=1><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/%ED%95%A8%EC%88%98%ED%98%95%EC%BD%94%EB%94%A9/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>쏙쏙 들어오는 함수형 코딩</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu" name=일기장 data-level=0><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>일기장
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item page-menu" name=23.07.18 data-level=1><a href=/posts/%EC%9D%BC%EA%B8%B0%EC%9E%A5/23-07-18/ class=page><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>23.07.18</span>
<span class=menu-suffix></span></a></li></ul></div></li><ul></nav></div></div><div class=sidebar-footer></div></aside></div><style scoped></style><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/pro-sidebar.css><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition()},!1),window.addEventListener("resize",function(){checkTocPosition()},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("menu-container").style.display="":document.getElementById("menu-container").style.display="none"}</script><div class=post-content><hr><style>#callout{background:#f1f1ef;padding:1.5em 1.25em;border-radius:3px;display:flex;flex-direction:row;margin-bottom:20px;color:var(--hljs-bg)}#callout-inner{margin-left:1em;white-space:pre-line}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡</div><div id=callout-inner>프로젝트가 자체 Migration 작업을 하고 있다! 하여 다른 모듈에서 공통 코드를 Enum화 하기 시작했는데, 그 중 interface Class를 통하여 공통코드를 관리하게 작업하였다!
나 또한 새로운 작업 때문에 유효성 검증 로직에 공통코드 검증 로직의 추가가 필요 했는데 해당 interface를 활용하여 @Valid 작업을 통해 간편하게 검증을 하면 좋겠다고 생각하여 해당 작업을 하게 됐다!! 😁😁 한번 만들어보자~~</div></div><h2 id=문제-정의>문제 정의<a hidden class=anchor aria-hidden=true href=#문제-정의>#</a></h2><p>현재 공통코드 값으로 검증하는 로직은 각자 정적인 방식으로 검증하는 로직을 사용하거나 검증을 하지 않고 있다.</p><p>하여 사용하지 않는 코드 값이 들어갈 가능성이 존재하고, 작업자로 하여금 코드 값을 검증하는 코드를 정적으로 끼워 넣는 경우가 다수 발생하고 있다. 그 결과로 코드 값에 관련한 프로세스를 한 눈에 보기 어렵고 유지보수에 애로사항이 생기게 되었다.</p><h2 id=해결-방안>해결 방안<a hidden class=anchor aria-hidden=true href=#해결-방안>#</a></h2><p>기존의 몇몇 모듈에서는 Spring의 @Validated Annotation 기능을 활용하여 유효성 검증을 하고 있다! 간단하게 몇몇 Annotation을 통해서 검증을 할 수 있어서 편리해 사용하고 있다. 하여 위의 Annotation의 동작을 통하여 공통코드 Field 값 또한 검증을 하면 좋겠다는 생각에서 접근하게 됐다!</p><p>@Validated로 동작하는 Custom Validator Annotation을 만든다! value 값으로 공통코드 interface로 구현된 Enum Class를 받아 간단하게 검증 프로세스를 추가할 수 있도록 한다.</p><h2 id=작업-내용>작업 내용<a hidden class=anchor aria-hidden=true href=#작업-내용>#</a></h2><ul><li><p>CommonCode Annotation</p><p>기본적으로 <code>javax.validation</code> package의 Validate Annotaion 형태를 구현한다!</p><ul><li>@Target - Annotation 적용 범위 설정</li><li>@Rentention - Annotaion 유지 범위 설정</li><li>@Constraint - 검증 Class 설정 (<strong>ConstraintValidator class 구현체)</strong></li><li>message - 검증 실패 시 return 문구</li><li>groups - 수행할 그룹 지정</li><li>payload - 검증 수행 클라이언트에서 사용 가능한 메타 데이터 지정 <a href=https://www.logicbig.com/tutorials/java-ee-tutorial/bean-validation/constraint-payload.html>참고</a></li></ul><p>단, target은 Field 만으로 설정한다.</p><p>추가로 공통코드 interface Class를 Field 값으로 추가한다!</p><p>검증 프로세스를 수행하는 <strong>ConstraintValidator</strong>(CommonCodeValidator)를 주입한다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Target</span><span class=o>(</span><span class=n>ElementType</span><span class=o>.</span><span class=na>FIELD</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Retention</span><span class=o>(</span><span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Constraint</span><span class=o>(</span><span class=n>validatedBy</span> <span class=o>=</span> <span class=n>CommonCodeValidator</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=nd>@interface</span> <span class=n>CommonCode</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=nf>message</span><span class=o>()</span> <span class=k>default</span> <span class=s>&#34;Not contain.&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>groups</span><span class=o>()</span> <span class=k>default</span> <span class=o>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Payload</span><span class=o>&gt;[]</span> <span class=nf>payload</span><span class=o>()</span> <span class=k>default</span> <span class=o>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>CommonCode</span><span class=o>&gt;</span> <span class=nf>commonCodeClass</span><span class=o>()</span> <span class=k>default</span> <span class=n>CommonCode</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li><li><p>CommonCodeValidator (implements <strong>ConstraintValidator</strong>)</p><p><strong><code>ConstraintValidator</code></strong> 를 구현한다!</p><p>위 Annotaion이 선언된 field 값 검증을 수행한다! Annotaion에 정의한 Enum Class 내의 Code값 중 동일한 값이 없다면 검증에 실패한다.</p><ul><li>단, empty Text는 제외한다.</li><li>구현체가 없는 Class 정의 시 통과되지 않는다. (Warn log를 남긴다)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CommonCodeValidator</span> <span class=kd>implements</span> <span class=n>ConstraintValidator</span><span class=o>&lt;</span><span class=n>CommonCode</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>CommonCode</span><span class=o>&gt;</span> <span class=n>commonCodeClass</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>initialize</span><span class=o>(</span><span class=n>CommonCode</span> <span class=n>constraintAnnotation</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ConstraintValidator</span><span class=o>.</span><span class=na>super</span><span class=o>.</span><span class=na>initialize</span><span class=o>(</span><span class=n>constraintAnnotation</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>commonCodeClass</span> <span class=o>=</span> <span class=n>constraintAnnotation</span><span class=o>.</span><span class=na>commonCodeClass</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isValid</span><span class=o>(</span><span class=n>String</span> <span class=n>str</span><span class=o>,</span> <span class=n>ConstraintValidatorContext</span> <span class=n>constraintValidatorContext</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(!</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>hasText</span><span class=o>(</span><span class=n>str</span><span class=o>))</span> <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(!</span><span class=n>isEnumSubclass</span><span class=o>(</span><span class=n>commonCodeClass</span><span class=o>)){</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>warn</span><span class=o>(</span><span class=s>&#34;It&#39;s not CommonCode&#39;s Enum class.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CommonCode</span><span class=o>[]</span> <span class=n>enumConstants</span> <span class=o>=</span> <span class=n>commonCodeClass</span><span class=o>.</span><span class=na>getEnumConstants</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>enumConstants</span><span class=o>).</span><span class=na>anyMatch</span><span class=o>(</span><span class=n>el</span><span class=o>-&gt;</span> <span class=n>str</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>el</span><span class=o>.</span><span class=na>getCode</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isEnumSubclass</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>clazz</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Enum</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>clazz</span><span class=o>.</span><span class=na>getSuperclass</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>❗ interface class를 그대로 주입하는 경우, value 값을 지정하지 않은 경우를 보완하기 위해 Enum class인지 체크하는 프로세스를 통해 위 경우를 방지한다!</p></li><li><p>CommonCode (참고)</p><p><code>String getCode()</code> inteface method를 통하여 code값을 꺼내 비교한다.</p></li></ul><h3 id=사용-예>사용 예<a hidden class=anchor aria-hidden=true href=#사용-예>#</a></h3><p>적용 할 Entity, DTO class에 해당 Annotaion을 선언하고, 검증 할 enum Class를 작성한다!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Getter</span>
</span></span><span class=line><span class=cl><span class=nd>@Setter</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>entityClass</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ~~~~~~
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>@CommonCode</span><span class=o>(</span><span class=n>commonCodeClass</span> <span class=o>=</span> <span class=n>TEST101</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=n>testCommonCode</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ~~~~~~
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div><h2 id=알게된-점>알게된 점<a hidden class=anchor aria-hidden=true href=#알게된-점>#</a></h2><p><code>CommonCodeValidator</code> 를 정의할 때에 Annotation에 선언한 value 값을 가져오는 부분이 어려웠다! 해당 Validator가 Singleton pattern으로 사용될 것이라고 생각해서 자연스럽게 <code>isValid</code> method 부분에서 context에 현재 선언된 <code>Enum class</code> 를 받아와 검증할 것이라고 생각했다!</p><p>하지만 내용을 찾아본 결과 값을 참조하는 방식이 해당 class의 멤버 변수로 선언하고 init 시점에 주입하여 사용한다는 것이였다!!! 🤔🤔</p><p>하여 이 방식이 궁금하여 debugging을 돌려본 결과.. 해당 Validator은 선언한 value값을 key로 하여 n개 만큼 생성되고 동작한다는 것이였다!! 🤣</p><p>혹시나 하여 다른 <code>@Size</code> 등의 기본 Annotation 소스를 살펴본 결과.. 똑같았다..!!
당연하게 Singleton pattern을 사용하여 자원을 아껴 동작할 줄 알았는데..? 예상과 달라 당황스러웠지만..! 그래도 내부 동작 방식에 대해 조금 더 이해하게 되어 좋았다!!</p><p>하여 최종적으로는 해당 Validator이 사용한 Enum class 만큼 늘어날 수 있다는 정보를 얻었다!! 실제로 이 내용에 대해 Memory 점유 문제가 걱정되어 검색을 해봤지만, 왠만한 size로는 부하를 줄 정도로는 점유하지 않는다고 한다..! (그냥 요즘 서버 Spec이 좋아져서 그런 것 같다!!)</p><p>추가적으로 Custom Annotation을 정의하는 부분은 검색 시 쉽게 찾아볼 수 있다! 이는 다른 글에서 정리해서 다시 올려야겠다..</p><h2 id=내-생각>내 생각<a hidden class=anchor aria-hidden=true href=#내-생각>#</a></h2><p>사실 유효성 검증 로직은 어느 비즈니스, 어떤 모듈이건 다 공통적으로 무조건 들어가는 프로세스 중 하나 이다! 어떻게 보면 Back-end 에서 가장 기본이 되는 부분이기도 하다. 사실 이 부분을 Annotation을 통해 간단하게 설정하면 매우 좋지만! 특수한 여러 케이스의 경우는 사용이 불가능한 경우도 있어 service 단에서 따로 작업을 했었다..!</p><p>헌데 위와 같이 간단하게 코드 데이터를 쉽게 검증하는 Annotation을 추가하니 매우 작업이 편해졌다..! 결국 위 로직을 통해 DB에 정의된 Code 이외의 값이 들어갈 가능성이 아예 사라진 것이니 데이터의 무결성이 한층 높아진 것 아닐까..? (물론 Service 영역에서 말이고 DB 영역은 논외다! 착각 ㄴㄴ..😅)</p><p>위 과정을 통해 Entity Class에서 DDL의 대부분 role이 mapping 되서 정의할 수 있다는 장점도 좋은 것 같다! 물론 주석으로 공통코드 name을 mapping 해두는 아름다운 작업자들도 있지만.. 그런 소스나 글이 전혀 없어 한참 추적하여 해당 cd값에 맞는 공통코드를 찾아가는 경우도 있었다..! 하여 해당하는 Classs를 정의하는 곳에 직접 주입하니, 유지/보수 과정에서도 작업 시간이 훨씬 단축된 듯 하였다!</p><p>사실상 Custom Annotation은 활용 영역이 무궁무진 한 것 같다..! 지금까지 활용해본 예는 Masking, Validate 등이 전부지만 남발하지 않는 선에서의 활용은 프로젝트 관리 측면에서는 매우 이점이 많을 것 같다!! 다른 기능도 조금씩 구현해보자..!! 😋</p><p>참고
<a href=https://www.baeldung.com/spring-mvc-custom-validator>Spring MVC Custom Validation | Baeldung</a>
<a href=https://wildeveloperetrain.tistory.com/157>(Spring Boot) Custom Validator 적용하는 방법, 단일 및 다중 필드</a>
<a href=https://m.blog.naver.com/aservmz/222823126774>[Spring] 45. Spring Validation을 이용한 유효성 검증(2) - @Constraint, ConstraintValidator</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://HyoseungJeon.github.io/tags/spring/>Spring</a></li><li><a href=https://HyoseungJeon.github.io/tags/validate/>Validate</a></li><li><a href=https://HyoseungJeon.github.io/tags/java/>Java</a></li><li><a href=https://HyoseungJeon.github.io/tags/annotation/>Annotation</a></li></ul><nav class=paginav><a class=prev href=https://HyoseungJeon.github.io/posts/java/threadlocal/><span class=title>« Prev</span><br><span>Thread Local</span></a>
<a class=next href=https://HyoseungJeon.github.io/posts/java/blockingqueue/><span class=title>Next »</span><br><span>Blocking Queue</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://HyoseungJeon.github.io/>HyoSeung IT blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>