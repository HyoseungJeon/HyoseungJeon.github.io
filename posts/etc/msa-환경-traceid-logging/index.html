<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MSA 환경 TraceId Logging | HyoSeung IT blog</title><meta name=keywords content="MSA,Monitoring,Sleuth,Zipkin"><meta name=description content="💡 요즘 프로젝트를 가면 다 MSA 환경으로 개발하고 있다! 하여 APM을 통한 모니터링을 할 때 TraceId를 통해 flow를 확인하고 있는데.. 실제로 이게 어떻게 구현되는지 궁금했다..! 한번 그에 대해 내용을 알아보자~~~!😊😊 개요 MSA 환경의 Monitoring 대부분의 프로젝트는 요즘 분산 환경으로 구현되어 있다! 하여 복잡한 로직들은 N개의 프로젝트 흐름을 거쳐 실행된다! 하지만 실제로 해당 흐름을 추적하는 일은 조금 어렵다.. (Trace Id가 없었다면..!) 하여 위와 같은 애로사항을 해결하기 위한 방법이 필요했고 그 방식으로 TraceId를 부여하는 logging 방식이 등장했다!"><meta name=author content="HyoSeung Jeon"><link rel=canonical href=https://HyoseungJeon.github.io/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://HyoseungJeon.github.io/profile.png><link rel=icon type=image/png sizes=16x16 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://HyoseungJeon.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><script defer crossorigin=anonymous src=/js/pro.sidebar.js></script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="MSA 환경 TraceId Logging"><meta property="og:description" content="💡 요즘 프로젝트를 가면 다 MSA 환경으로 개발하고 있다! 하여 APM을 통한 모니터링을 할 때 TraceId를 통해 flow를 확인하고 있는데.. 실제로 이게 어떻게 구현되는지 궁금했다..! 한번 그에 대해 내용을 알아보자~~~!😊😊 개요 MSA 환경의 Monitoring 대부분의 프로젝트는 요즘 분산 환경으로 구현되어 있다! 하여 복잡한 로직들은 N개의 프로젝트 흐름을 거쳐 실행된다! 하지만 실제로 해당 흐름을 추적하는 일은 조금 어렵다.. (Trace Id가 없었다면..!) 하여 위와 같은 애로사항을 해결하기 위한 방법이 필요했고 그 방식으로 TraceId를 부여하는 logging 방식이 등장했다!"><meta property="og:type" content="article"><meta property="og:url" content="https://HyoseungJeon.github.io/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/"><meta property="og:image" content="https://HyoseungJeon.github.io/profile2.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-22T10:26:29+09:00"><meta property="article:modified_time" content="2023-11-22T10:26:29+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://HyoseungJeon.github.io/profile2.png"><meta name=twitter:title content="MSA 환경 TraceId Logging"><meta name=twitter:description content="💡 요즘 프로젝트를 가면 다 MSA 환경으로 개발하고 있다! 하여 APM을 통한 모니터링을 할 때 TraceId를 통해 flow를 확인하고 있는데.. 실제로 이게 어떻게 구현되는지 궁금했다..! 한번 그에 대해 내용을 알아보자~~~!😊😊 개요 MSA 환경의 Monitoring 대부분의 프로젝트는 요즘 분산 환경으로 구현되어 있다! 하여 복잡한 로직들은 N개의 프로젝트 흐름을 거쳐 실행된다! 하지만 실제로 해당 흐름을 추적하는 일은 조금 어렵다.. (Trace Id가 없었다면..!) 하여 위와 같은 애로사항을 해결하기 위한 방법이 필요했고 그 방식으로 TraceId를 부여하는 logging 방식이 등장했다!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://HyoseungJeon.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ETC","item":"https://HyoseungJeon.github.io/posts/etc/"},{"@type":"ListItem","position":3,"name":"MSA 환경 TraceId Logging","item":"https://HyoseungJeon.github.io/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MSA 환경 TraceId Logging","name":"MSA 환경 TraceId Logging","description":"💡 요즘 프로젝트를 가면 다 MSA 환경으로 개발하고 있다! 하여 APM을 통한 모니터링을 할 때 TraceId를 통해 flow를 확인하고 있는데.. 실제로 이게 어떻게 구현되는지 궁금했다..! 한번 그에 대해 내용을 알아보자~~~!😊😊 개요 MSA 환경의 Monitoring 대부분의 프로젝트는 요즘 분산 환경으로 구현되어 있다! 하여 복잡한 로직들은 N개의 프로젝트 흐름을 거쳐 실행된다! 하지만 실제로 해당 흐름을 추적하는 일은 조금 어렵다.. (Trace Id가 없었다면..!) 하여 위와 같은 애로사항을 해결하기 위한 방법이 필요했고 그 방식으로 TraceId를 부여하는 logging 방식이 등장했다!","keywords":["MSA","Monitoring","Sleuth","Zipkin"],"articleBody":" 💡 요즘 프로젝트를 가면 다 MSA 환경으로 개발하고 있다! 하여 APM을 통한 모니터링을 할 때 TraceId를 통해 flow를 확인하고 있는데.. 실제로 이게 어떻게 구현되는지 궁금했다..! 한번 그에 대해 내용을 알아보자~~~!😊😊 개요 MSA 환경의 Monitoring 대부분의 프로젝트는 요즘 분산 환경으로 구현되어 있다! 하여 복잡한 로직들은 N개의 프로젝트 흐름을 거쳐 실행된다! 하지만 실제로 해당 흐름을 추적하는 일은 조금 어렵다.. (Trace Id가 없었다면..!) 하여 위와 같은 애로사항을 해결하기 위한 방법이 필요했고 그 방식으로 TraceId를 부여하는 logging 방식이 등장했다!\nTraceId 채번을 통한 Logging 방식은 Spring Boot Project에선 주로 Zipkin, Spring Cloud Sleuth 로 구현한다!\nZipkin 분산 어플리케이션 환경에서 흐름에 대한 정보를 수집하는 역할을 하는 Lib 이다.\nSpring Cloud Sleuth Spring Boot 내에서 분산 추적을 위한 자동 구성을 지원하는 Lib 이다.\n각 Lib에 대한 자세한 내용은 밑에서 다루어 보자!\nZipkin 정의 Zipkin is a distributed tracing system. It helps gather timing data needed to troubleshoot latency problems in service architectures. Features include both the collection and lookup of this data.\nIf you have a trace ID in a log file, you can jump directly to it. Otherwise, you can query based on attributes such as service, operation name, tags and duration. Some interesting data will be summarized for you, such as the percentage of time spent in a service, and whether or not operations failed.\n출처 - https://zipkin.io/\n즉, Zipkin은 시스템의 흐름 데이터를 수집하여 차후에 특정 시간대나 특정 요청에 대한 데이터를 확인할 수 있도록 돕는 시스템 입니다!\n이는 trace ID 등 여러 데이터를 기준으로 조회할 수 있고 소요 시간, 실패 여부 등의 정보를 확인할 수 있습니다!\n구현 방식 Applications need to be “instrumented” to report trace data to Zipkin. This usually means configuration of a tracer or instrumentation library. The most popular ways to report data to Zipkin are via HTTP or Kafka, though many other options exist, such as Apache ActiveMQ, gRPC and RabbitMQ. The data served to the UI are stored in-memory, or persistently with a supported backend such as Apache Cassandra or Elasticsearch.\nZipkin 서버 쪽으로 Log 정보들을 전송하여 쌓게 되고, 대표적으로 Http, Kafka 등을 사용하여 전송하게 된다. UI는 메모리 기반으로 Zipkin의 기본 화면을 사용하거나 다른 System을 붙여서 사용할 수 있다! 대체적으로 ELK 환경(Elastic Search, Kibana)과 연결 지어 사용하는 것 같다!\n구조 ❗ Request 결과 전송은 response 응답 후에 비동기 방식으로 쌓는다! 때문에 따로 reponse 응답에 시간 소요에는 영향을 끼치지 않는다. 본 System은 어려운 점은 없다! 따로 큰 부하 없이 효율적인 로직으로 logging 정보를 수집, 정리, 조회 API 등의 역할을 한다. 여러 언어의 프로젝트에 붙여 사용할 수 있고, 사용자 커스텀 기능도 지원한다. 때문에 프로젝트의 Logging 목적에 맞추어 여러 데이터를 활용할 수 있다.\nSpring Cloud Sleuth 개요 및 특징 Overview\nSpring Cloud Sleuth provides Spring Boot auto-configuration for distributed tracing.\nFeatures\nSleuth configures everything you need to get started. This includes where trace data (spans) are reported to, how many traces to keep (sampling), if remote fields (baggage) are sent, and which libraries are traced.\nSpecifically, Spring Cloud Sleuth…\nAdds trace and span ids to the Slf4J MDC, so you can extract all the logs from a given trace or span in a log aggregator. Instruments common ingress and egress points from Spring applications (servlet filter, rest template, scheduled actions, message channels, feign client). If spring-cloud-sleuth-zipkin is available then the app will generate and report Zipkincompatible traces via HTTP. By default it sends them to a Zipkin collector service on localhost (port 9411). Configure the location of the service using spring.zipkin.baseUrl. 출처 - https://spring.io/projects/spring-cloud-sleuth/#overview\n기능 실제로 Trace Id, span Id 등 request에 고유 식별 값(id)을 부여하는 Lib 이다. 특히나 Zipkin과 쉽게 연동이 가능한 Lib도 제공하고 있어 Spring 환경에서 해당 시스템을 붙이기 매우 쉽다!\n구현 기능의 동작은 간단하다! 기본적으로 Http Header에 b3-propagation 규격으로 값들을 주고 받는다!\nTrace Id 값은 없을 시 부여하고 갱신하지 않고, span Id는 새로운 모듈의 인입 시점마다 새로 부여한다!\n위 방식을 통해 trace Id값과 span Id 값을 추출하고 header에 담아 식별 값을 부여하고, Logging 하게 된다!\nID 부여 Flow Sleuth도 사용법은 굉장히 간단하다. 실제로 동작 방식을 보았을 때에는 특별하게 구현된 로직이나 방법은 딱히 보이지 않는다! 굉장히 간단한 방식과 정해진 규격을 통해서 깔끔하게 MSA 환경 에서의 추적 환경을 쉽게 구성해주는 것 같다!\n내 생각 SI, SM 애초에 개발이라는 영역 내에서 Monitoring 이나 Debugging은 매우 중요한 요소이다. 헌데 MSA 환경이 등장하고 여러 모듈에 걸친 복잡한 Process가 생기고, 만약 문제가 생겼을 때에 그 해결 과정은 매우 복잡했을 것 같다.. 문제를 파악하는 과정 에서도 분명히 애로사항이 크지 않았을까..? log에 프로젝트 고유의 id 값을 부여하고 logging 하는 공통 로직을 넣거나 하는 등의 방식을 사용했을 것 같다. 하지만 Spring과 Zipkin을 통하여 단순히 Lib를 더하고, 프로젝트에 맞춘 사용자 정의만 한다면 이 모든 것이 매우 쉽게 구현된다!! 이 얼마나 놀라운가.. 화려하고 어려운 로직이 아님에도 아마 많은 MSA 환경 프로젝트들이 구원 받았을 것이다!! 😂😂\nAPM을 통해서 Id 값을 통해 MSA 환경에서도 매우 쉽게 Monitoring 하다가 문득 이 값들은 도대체 어떻게 생성되고 관리되는 거지 라는 궁금증에서 시작했는데 의외로 여러 영역에 걸쳐 다양한 정보들을 배울 수 있어서 재밌었다..!! 간단하게 끝날 일인 줄 알았는데 구글링을 꽤나 오래 했던 것 같다.. 신선하고 놀라운 동작보다는 여러 Lib의 하모니를 통한 편한 환경 구축에 대해 보았다 흐흐.. 역시 Lib 짱짱..?😎😎\n출처 MSA 환경에서 분산 추적시스템 적용하기 [마이크로서비스] 분산추적 Spring Cloud Sleuth, Zipkin, ELK (10) OpenZipkin · A distributed tracing system Spring Cloud Sleuth [MSA] MSA 환경 분산 로그 트레이싱 (분산 트랜잭션\u0026시스템 추적) - 개발하는 지토\n","wordCount":"858","inLanguage":"en","datePublished":"2023-11-22T10:26:29+09:00","dateModified":"2023-11-22T10:26:29+09:00","author":{"@type":"Person","name":"HyoSeung Jeon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://HyoseungJeon.github.io/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/"},"publisher":{"@type":"Organization","name":"HyoSeung IT blog","logo":{"@type":"ImageObject","url":"https://HyoseungJeon.github.io/profile.png"}}}</script><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/main.css></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://HyoseungJeon.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://HyoseungJeon.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://HyoseungJeon.github.io/posts/ title=posts class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>posts</span></a></li><li><a href=https://HyoseungJeon.github.io/tags/ title=tags class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>tags</span></a></li><li><a href=https://HyoseungJeon.github.io/archives/ title=archives class=btn-12><span style=font-family:SUITE-Regular;font-size:19px>archives</span></a></li><li><a href=https://HyoseungJeon.github.io/search/ title="search (Alt + /)" class=btn-12 accesskey=/><span style=font-family:SUITE-Regular;font-size:19px>search</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://HyoseungJeon.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://HyoseungJeon.github.io/posts/etc/>ETC</a></div><h1 class=post-title>MSA 환경 TraceId Logging</h1><div class=post-meta><span title='2023-11-22 10:26:29 +0900 +0900'>November 22, 2023</span>&nbsp;·&nbsp;858 words&nbsp;·&nbsp;HyoSeung Jeon</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner style=padding-top:10px><ul><li><a href=#%ea%b0%9c%ec%9a%94 aria-label=개요>개요</a><ul><li><a href=#msa-%ed%99%98%ea%b2%bd%ec%9d%98-monitoring aria-label="MSA 환경의 Monitoring">MSA 환경의 Monitoring</a></li><li><a href=#zipkin aria-label=Zipkin>Zipkin</a></li><li><a href=#spring-cloud-sleuth aria-label="Spring Cloud Sleuth">Spring Cloud Sleuth</a></li></ul></li><li><a href=#zipkin-1 aria-label=Zipkin>Zipkin</a><ul><li><a href=#%ec%a0%95%ec%9d%98 aria-label=정의>정의</a></li><li><a href=#%ea%b5%ac%ed%98%84-%eb%b0%a9%ec%8b%9d aria-label="구현 방식">구현 방식</a></li><li><a href=#%ea%b5%ac%ec%a1%b0 aria-label=구조>구조</a></li></ul></li><li><a href=#spring-cloud-sleuth-1 aria-label="Spring Cloud Sleuth">Spring Cloud Sleuth</a><ul><li><a href=#%ea%b0%9c%ec%9a%94-%eb%b0%8f-%ed%8a%b9%ec%a7%95 aria-label="개요 및 특징">개요 및 특징</a></li><li><a href=#%ea%b8%b0%eb%8a%a5 aria-label=기능>기능</a></li><li><a href=#%ea%b5%ac%ed%98%84 aria-label=구현>구현</a></li><li><a href=#id-%eb%b6%80%ec%97%ac-flow aria-label="ID 부여 Flow">ID 부여 Flow</a></li></ul></li><li><a href=#%eb%82%b4-%ec%83%9d%ea%b0%81 aria-label="내 생각">내 생각</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?(document.getElementById("toc-container").classList.add("wide"),document.getElementById("menu-container").style.display=""):(document.getElementById("toc-container").classList.remove("wide"),document.getElementById("menu-container").style.display="none")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css><link rel=stylesheet href=https://unpkg.com/css-pro-layout@1.1.0/dist/css/css-pro-layout.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"><script src=https://unpkg.com/@popperjs/core@2></script><div id=menu-container class="layout toc-container wide-r"><aside id=sidebar class="sidebar break-point-sm has-bg-image" style=width:100%;position:sticky;top:var(--gap)><div class=sidebar-layout><div class=sidebar-content><nav class="menu open-current-submenu"><ul><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>API
<span class=menu-title-suffix>(4)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/api/fcm/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>FCM</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice 본인인증</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%91/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증 이슈대응</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/api/nice%EB%B3%B8%EC%9D%B8%EC%9D%B8%EC%A6%9D%EC%9D%B4%EC%8A%88%EB%8C%80%EC%9D%912/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nice본인인증이슈대응2</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Chrome
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/chrome/debug/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Debug</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Design Patterns
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Behavioral Patterns
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/designpattern/behavioral-patterns/strategypattern/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Strategy Pattern</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class=menu-item><a href=/posts/designpattern/creational-patterns/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Creational Patterns</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/designpattern/structural-patterns/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Structural Patterns</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>ETC
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/etc/msa-%ED%99%98%EA%B2%BD-traceid-logging/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>MSA 환경 TraceId Logging</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Intellij
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/intellij/propertiesautoupper/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Properties Auto Upper</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/intellij/thymeleaf/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Thymeleaf</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java
<span class=menu-title-suffix>(7)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/java/cursor/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Cursor</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/file/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>File</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/function-package/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Function Package</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/future/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Future</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/generic/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Generic</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/reflection/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Reflection</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/java/synchronized/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Synchronized</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Java Script
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/javascript/validate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Custom Validate</span>
<span class=menu-suffix></span></a></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Date
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/javascript/date/setdate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>setDate</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class=menu-item><a href=/posts/javascript/pagereloadissue/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Page Reload Issue</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>JQuery
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/jquery/validate/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>JQuery Validate</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/jquery/ztree/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>ZTree</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Spring
<span class=menu-title-suffix>(3)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/spring/async/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Async</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/spring/requestcontextholder/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>RequestContextHolder</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/spring/springsecurity/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Spring Security</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>SQL
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/sql/withrecursive/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>With Recursive</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>Window
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/window/nud%EB%A9%94%EB%AA%A8%EB%A6%AC%EB%88%84%EC%88%98/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Nud 메모리누수</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>독후감
<span class=menu-title-suffix>(2)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/cleanarchitecture/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>Clean Architecture</span>
<span class=menu-suffix></span></a></li><li class=menu-item><a href=/posts/%EB%8F%85%ED%9B%84%EA%B0%90/%ED%95%A8%EC%88%98%ED%98%95%EC%BD%94%EB%94%A9/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>쏙쏙 들어오는 함수형 코딩</span>
<span class=menu-suffix></span></a></li></ul></div></li><li class="menu-item sub-menu"><a href=#><span class=menu-icon><i class=ri-book-line></i></span>
<span class=menu-title>일기장
<span class=menu-title-suffix>(1)</span></span>
<span class=menu-suffix></span></a><div class=sub-menu-list data-popper-placement=left><ul><li class=menu-item><a href=/posts/%EC%9D%BC%EA%B8%B0%EC%9E%A5/23-07-18/><span class=menu-icon><i class=ri-sticky-note-fill></i></span>
<span class=menu-title>23.07.18</span>
<span class=menu-suffix></span></a></li></ul></div></li><ul></nav></div></div><div class=sidebar-footer><div class=footer-box><div></div><div style="padding:0 10px"><span style=display:block;margin-bottom:10px>Pro sidebar is also available as a react package</span><div style=margin-bottom:15px><img alt="preview badge" src="https://img.shields.io/github/stars/azouaoui-med/react-pro-sidebar?style=social"></div><div><a href=https://github.com/azouaoui-med/react-pro-sidebar target=_blank>Check it out!</a></div></div></div></div></aside></div><style scoped></style><link rel=stylesheet href=https://HyoseungJeon.github.io/scss/pro-sidebar.css><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition()},!1),window.addEventListener("resize",function(){checkTocPosition()},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("menu-container").style.display="":document.getElementById("menu-container").style.display="none"}</script><div class=post-content><hr><style>#callout{background:#f1f1ef;padding:1.5em 1.25em;border-radius:3px;display:flex;flex-direction:row;margin-bottom:20px;color:var(--hljs-bg)}#callout-inner{margin-left:1em;white-space:pre-line}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>💡</div><div id=callout-inner>요즘 프로젝트를 가면 다 MSA 환경으로 개발하고 있다! 하여 APM을 통한 모니터링을 할 때 TraceId를 통해 flow를 확인하고 있는데.. 실제로 이게 어떻게 구현되는지 궁금했다..! 한번 그에 대해 내용을 알아보자~~~!😊😊</div></div><h2 id=개요>개요<a hidden class=anchor aria-hidden=true href=#개요>#</a></h2><h3 id=msa-환경의-monitoring>MSA 환경의 Monitoring<a hidden class=anchor aria-hidden=true href=#msa-환경의-monitoring>#</a></h3><p>대부분의 프로젝트는 요즘 분산 환경으로 구현되어 있다! 하여 복잡한 로직들은 N개의 프로젝트 흐름을 거쳐 실행된다! 하지만 실제로 해당 흐름을 추적하는 일은 조금 어렵다.. (Trace Id가 없었다면..!)
하여 위와 같은 애로사항을 해결하기 위한 방법이 필요했고 그 방식으로 TraceId를 부여하는 logging 방식이 등장했다!</p><p>TraceId 채번을 통한 Logging 방식은 Spring Boot Project에선 주로 Zipkin, Spring Cloud Sleuth 로 구현한다!</p><h3 id=zipkin>Zipkin<a hidden class=anchor aria-hidden=true href=#zipkin>#</a></h3><p>분산 어플리케이션 환경에서 흐름에 대한 정보를 수집하는 역할을 하는 Lib 이다.</p><h3 id=spring-cloud-sleuth>Spring Cloud Sleuth<a hidden class=anchor aria-hidden=true href=#spring-cloud-sleuth>#</a></h3><p>Spring Boot 내에서 분산 추적을 위한 자동 구성을 지원하는 Lib 이다.</p><p>각 Lib에 대한 자세한 내용은 밑에서 다루어 보자!</p><h2 id=zipkin-1>Zipkin<a hidden class=anchor aria-hidden=true href=#zipkin-1>#</a></h2><h3 id=정의>정의<a hidden class=anchor aria-hidden=true href=#정의>#</a></h3><blockquote><p>Zipkin is a distributed tracing system. It helps gather timing data needed to troubleshoot latency problems in service architectures. Features include both the collection and lookup of this data.</p><p>If you have a trace ID in a log file, you can jump directly to it. Otherwise, you can query based on attributes such as service, operation name, tags and duration. Some interesting data will be summarized for you, such as the percentage of time spent in a service, and whether or not operations failed.</p><p>출처 - <a href=https://zipkin.io/>https://zipkin.io/</a></p></blockquote><p>즉, Zipkin은 시스템의 흐름 데이터를 수집하여 차후에 특정 시간대나 특정 요청에 대한 데이터를 확인할 수 있도록 돕는 시스템 입니다!</p><p>이는 trace ID 등 여러 데이터를 기준으로 조회할 수 있고 소요 시간, 실패 여부 등의 정보를 확인할 수 있습니다!</p><h3 id=구현-방식>구현 방식<a hidden class=anchor aria-hidden=true href=#구현-방식>#</a></h3><blockquote><p>Applications need to be “instrumented” to report trace data to Zipkin. This usually means configuration of a <a href=https://zipkin.io/pages/tracers_instrumentation>tracer or instrumentation library</a>. The most popular ways to report data to Zipkin are via HTTP or Kafka, though many other options exist, such as Apache ActiveMQ, gRPC and RabbitMQ. The data served to the UI are stored in-memory, or persistently with a supported backend such as Apache Cassandra or Elasticsearch.</p></blockquote><p>Zipkin 서버 쪽으로 Log 정보들을 전송하여 쌓게 되고, 대표적으로 Http, Kafka 등을 사용하여 전송하게 된다. UI는 메모리 기반으로 Zipkin의 기본 화면을 사용하거나 다른 System을 붙여서 사용할 수 있다! 대체적으로 ELK 환경(Elastic Search, Kibana)과 연결 지어 사용하는 것 같다!</p><h3 id=구조>구조<a hidden class=anchor aria-hidden=true href=#구조>#</a></h3><p><img loading=lazy src=/ZipkinArchitecture.png alt=ZipkinArchitecture></p><style>#callout{background:#f1f1ef;padding:1.5em 1.25em;border-radius:3px;display:flex;flex-direction:row;margin-bottom:20px;color:var(--hljs-bg)}#callout-inner{margin-left:1em;white-space:pre-line}@media(max-width:767px){#callout{padding:1.5em .75em 1.5em .6em}#callout-inner{margin-left:.5em}}</style><div id=callout><div>❗</div><div id=callout-inner>Request 결과 전송은 response 응답 후에 비동기 방식으로 쌓는다! 때문에 따로 reponse 응답에 시간 소요에는 영향을 끼치지 않는다.</div></div><p>본 System은 어려운 점은 없다! 따로 큰 부하 없이 효율적인 로직으로 logging 정보를 수집, 정리, 조회 API 등의 역할을 한다. 여러 언어의 프로젝트에 붙여 사용할 수 있고, 사용자 커스텀 기능도 지원한다. 때문에 프로젝트의 Logging 목적에 맞추어 여러 데이터를 활용할 수 있다.</p><h2 id=spring-cloud-sleuth-1>Spring Cloud Sleuth<a hidden class=anchor aria-hidden=true href=#spring-cloud-sleuth-1>#</a></h2><h3 id=개요-및-특징>개요 및 특징<a hidden class=anchor aria-hidden=true href=#개요-및-특징>#</a></h3><blockquote><p><strong>Overview</strong></p><p>Spring Cloud Sleuth provides Spring Boot auto-configuration for distributed tracing.</p><p><strong>Features</strong></p><p>Sleuth configures everything you need to get started. This includes where trace data (spans) are reported to, how many traces to keep (sampling), if remote fields (baggage) are sent, and which libraries are traced.</p><p>Specifically, Spring Cloud Sleuth…</p><ul><li>Adds trace and span ids to the Slf4J MDC, so you can extract all the logs from a given trace or span in a log aggregator.</li><li>Instruments common ingress and egress points from Spring applications (servlet filter, rest template, scheduled actions, message channels, feign client).</li><li>If <code>spring-cloud-sleuth-zipkin</code> is available then the app will generate and report <a href=https://zipkin.io/>Zipkin</a>compatible traces via HTTP. By default it sends them to a Zipkin collector service on localhost (port 9411). Configure the location of the service using <code>spring.zipkin.baseUrl</code>.</li></ul><p>출처 - <a href=https://spring.io/projects/spring-cloud-sleuth/#overview>https://spring.io/projects/spring-cloud-sleuth/#overview</a></p></blockquote><h3 id=기능>기능<a hidden class=anchor aria-hidden=true href=#기능>#</a></h3><p>실제로 Trace Id, span Id 등 request에 고유 식별 값(id)을 부여하는 Lib 이다. 특히나 Zipkin과 쉽게 연동이 가능한 Lib도 제공하고 있어 Spring 환경에서 해당 시스템을 붙이기 매우 쉽다!</p><h3 id=구현>구현<a hidden class=anchor aria-hidden=true href=#구현>#</a></h3><p>기능의 동작은 간단하다! 기본적으로 Http Header에 <a href=https://github.com/openzipkin/b3-propagation>b3-propagation</a> 규격으로 값들을 주고 받는다!</p><p>Trace Id 값은 없을 시 부여하고 갱신하지 않고, span Id는 새로운 모듈의 인입 시점마다 새로 부여한다!</p><p>위 방식을 통해 trace Id값과 span Id 값을 추출하고 header에 담아 식별 값을 부여하고, Logging 하게 된다!</p><h3 id=id-부여-flow>ID 부여 Flow<a hidden class=anchor aria-hidden=true href=#id-부여-flow>#</a></h3><p><img loading=lazy src=/SpringCloudSleuthFlow.png alt=SpringCloudSleuthFlow></p><p>Sleuth도 사용법은 굉장히 간단하다. 실제로 동작 방식을 보았을 때에는 특별하게 구현된 로직이나 방법은 딱히 보이지 않는다! 굉장히 간단한 방식과 정해진 규격을 통해서 깔끔하게 MSA 환경 에서의 추적 환경을 쉽게 구성해주는 것 같다!</p><h2 id=내-생각>내 생각<a hidden class=anchor aria-hidden=true href=#내-생각>#</a></h2><p>SI, SM 애초에 개발이라는 영역 내에서 Monitoring 이나 Debugging은 매우 중요한 요소이다. 헌데 MSA 환경이 등장하고 여러 모듈에 걸친 복잡한 Process가 생기고, 만약 문제가 생겼을 때에 그 해결 과정은 매우 복잡했을 것 같다.. 문제를 파악하는 과정 에서도 분명히 애로사항이 크지 않았을까..? log에 프로젝트 고유의 id 값을 부여하고 logging 하는 공통 로직을 넣거나 하는 등의 방식을 사용했을 것 같다. 하지만 Spring과 Zipkin을 통하여 단순히 Lib를 더하고, 프로젝트에 맞춘 사용자 정의만 한다면 이 모든 것이 매우 쉽게 구현된다!! 이 얼마나 놀라운가.. 화려하고 어려운 로직이 아님에도 아마 많은 MSA 환경 프로젝트들이 구원 받았을 것이다!! 😂😂</p><p>APM을 통해서 Id 값을 통해 MSA 환경에서도 매우 쉽게 Monitoring 하다가 문득 이 값들은 도대체 어떻게 생성되고 관리되는 거지 라는 궁금증에서 시작했는데 의외로 여러 영역에 걸쳐 다양한 정보들을 배울 수 있어서 재밌었다..!! 간단하게 끝날 일인 줄 알았는데 구글링을 꽤나 오래 했던 것 같다.. 신선하고 놀라운 동작보다는 여러 Lib의 하모니를 통한 편한 환경 구축에 대해 보았다 흐흐.. 역시 Lib 짱짱..?😎😎</p><p>출처
<a href=https://woodcock.tistory.com/43>MSA 환경에서 분산 추적시스템 적용하기</a>
<a href=https://velog.io/@hyeokjinon/%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EC%84%9C%EB%B9%84%EC%8A%A4-%EB%B6%84%EC%82%B0%EC%B6%94%EC%A0%81-Spring-Cloud-Sleuth-Zipkin-ELK-%EC%8A%A4%ED%83%9DElasticssearch-logstash-Kibana-10>[마이크로서비스] 분산추적 Spring Cloud Sleuth, Zipkin, ELK (10)</a>
<a href=https://zipkin.io/>OpenZipkin · A distributed tracing system</a>
<a href=https://spring.io/projects/spring-cloud-sleuth/#overview>Spring Cloud Sleuth</a>
<a href=https://jhhj424.tistory.com/66>[MSA] MSA 환경 분산 로그 트레이싱 (분산 트랜잭션&시스템 추적) - 개발하는 지토</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://HyoseungJeon.github.io/tags/msa/>MSA</a></li><li><a href=https://HyoseungJeon.github.io/tags/monitoring/>Monitoring</a></li><li><a href=https://HyoseungJeon.github.io/tags/sleuth/>Sleuth</a></li><li><a href=https://HyoseungJeon.github.io/tags/zipkin/>Zipkin</a></li></ul><nav class=paginav><a class=prev href=https://HyoseungJeon.github.io/posts/java/cursor/><span class=title>« Prev</span><br><span>Cursor</span></a>
<a class=next href=https://HyoseungJeon.github.io/posts/spring/springsecurity/><span class=title>Next »</span><br><span>Spring Security</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://HyoseungJeon.github.io/>HyoSeung IT blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>